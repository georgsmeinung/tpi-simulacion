<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>tpi-simulation-in-data-science – Trabajo Práctico Integral - Simulación en Ciencia de Datos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4ad0c40183745812e01848c6d8db1493.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Trabajo Práctico Integral - Simulación en Ciencia de Datos</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/georgsmeinung/tpi-simulacion/blob/main/tpi-simulation-in-data-science.ipynb"> 
<span class="menu-text">Código Fuente</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#maestría-en-ciencia-de-datos-20242025" id="toc-maestría-en-ciencia-de-datos-20242025" class="nav-link active" data-scroll-target="#maestría-en-ciencia-de-datos-20242025">Maestría en Ciencia de Datos 2024/2025</a>
  <ul class="collapse">
  <li><a href="#simulación-y-optimización-en-ciencia-de-datos" id="toc-simulación-y-optimización-en-ciencia-de-datos" class="nav-link" data-scroll-target="#simulación-y-optimización-en-ciencia-de-datos">Simulación y Optimización en Ciencia de Datos</a></li>
  <li><a href="#trabajo-práctico-integral" id="toc-trabajo-práctico-integral" class="nav-link" data-scroll-target="#trabajo-práctico-integral">Trabajo Práctico Integral</a>
  <ul class="collapse">
  <li><a href="#introducción" id="toc-introducción" class="nav-link" data-scroll-target="#introducción">Introducción</a></li>
  <li><a href="#sobre-el-código-base" id="toc-sobre-el-código-base" class="nav-link" data-scroll-target="#sobre-el-código-base">Sobre el código base</a></li>
  <li><a href="#configuración" id="toc-configuración" class="nav-link" data-scroll-target="#configuración">Configuración</a></li>
  <li><a href="#parte-1---generación-de-números-pseudoaleatorios-y-monte-carlo" id="toc-parte-1---generación-de-números-pseudoaleatorios-y-monte-carlo" class="nav-link" data-scroll-target="#parte-1---generación-de-números-pseudoaleatorios-y-monte-carlo">Parte 1 - Generación de Números Pseudoaleatorios y Monte Carlo</a></li>
  <li><a href="#parte-2---metropolishastings-y-bayesian-inference" id="toc-parte-2---metropolishastings-y-bayesian-inference" class="nav-link" data-scroll-target="#parte-2---metropolishastings-y-bayesian-inference">Parte 2 - Metropolis–Hastings y Bayesian Inference</a></li>
  <li><a href="#parte-3---simulación-de-eventos-discretos-mm1-o-mmc" id="toc-parte-3---simulación-de-eventos-discretos-mm1-o-mmc" class="nav-link" data-scroll-target="#parte-3---simulación-de-eventos-discretos-mm1-o-mmc">Parte 3 - Simulación de Eventos Discretos (M/M/1 o M/M/c)</a></li>
  <li><a href="#parte-4---modelos-continuos" id="toc-parte-4---modelos-continuos" class="nav-link" data-scroll-target="#parte-4---modelos-continuos">Parte 4 - Modelos Continuos</a></li>
  <li><a href="#parte-5---gillespie-ssa-o-next-reaction-method" id="toc-parte-5---gillespie-ssa-o-next-reaction-method" class="nav-link" data-scroll-target="#parte-5---gillespie-ssa-o-next-reaction-method">Parte 5 - Gillespie SSA o Next Reaction Method</a></li>
  <li><a href="#parte-integradora---simulación-de-tráfico-aéreo" id="toc-parte-integradora---simulación-de-tráfico-aéreo" class="nav-link" data-scroll-target="#parte-integradora---simulación-de-tráfico-aéreo">Parte Integradora - Simulación de Tráfico Aéreo</a></li>
  <li><a href="#uso-de-inteligencia-artificial" id="toc-uso-de-inteligencia-artificial" class="nav-link" data-scroll-target="#uso-de-inteligencia-artificial">Uso de Inteligencia Artificial</a></li>
  <li><a href="#anexo-código-base-en-python" id="toc-anexo-código-base-en-python" class="nav-link" data-scroll-target="#anexo-código-base-en-python">Anexo: Código base en Python</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="tpi-simulation-in-data-science.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<p><img src="https://raw.githubusercontent.com/georgsmeinung/tpi-simulacion/refs/heads/main/austral-ingenieria.png" class="img-fluid"></p>
<section id="maestría-en-ciencia-de-datos-20242025" class="level1">
<h1>Maestría en Ciencia de Datos 2024/2025</h1>
<section id="simulación-y-optimización-en-ciencia-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="simulación-y-optimización-en-ciencia-de-datos">Simulación y Optimización en Ciencia de Datos</h2>
</section>
<section id="trabajo-práctico-integral" class="level2">
<h2 class="anchored" data-anchor-id="trabajo-práctico-integral">Trabajo Práctico Integral</h2>
<p>Profesores:</p>
<ul>
<li>DEL ROSSO, Rodrigo</li>
<li>NUSKE, Ezequiel</li>
</ul>
<p>Integrantes:</p>
<ul>
<li>CANCELAS, Martín</li>
<li>FILIPUZZI, Juan Manuel</li>
<li>NICOLAU, Jorge</li>
</ul>
<section id="introducción" class="level3">
<h3 class="anchored" data-anchor-id="introducción">Introducción</h3>
<p>Este Trabajo Práctico (TP) integra los contenidos vistos en las clases</p>
<ul>
<li><strong>Unidad I</strong> – Generación de números pseudoaleatorios y Monte Carlo</li>
<li><strong>Unidad II</strong> – Bayes, cadenas de Markov y Metropolis–Hastings</li>
<li><strong>Unidad III</strong> – Simulación de eventos discretos (SED)</li>
<li><strong>Unidad IV</strong> – Procesos continuos (NHPP, CTMC, SDE)</li>
<li><strong>Unidad V</strong> – Reacciones químicas estocásticas: Gillespie SSA y Next Reaction Method</li>
</ul>
<p>El objetivo es que el alumno implemente técnicas de simulación, compare métodos, valide sus resultados y presente visualizaciones claras.</p>
</section>
<section id="sobre-el-código-base" class="level3">
<h3 class="anchored" data-anchor-id="sobre-el-código-base">Sobre el código base</h3>
<p>El código base propuesto en el enunciado en R se ha transformado a Python y se encuentra en el anexo al final del trabajo.</p>
</section>
<section id="configuración" class="level3">
<h3 class="anchored" data-anchor-id="configuración">Configuración</h3>
<p>Para el presente trabajo se utilizan los siguientes parámetros globales y semilla</p>
<div id="52571066" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.020388,&quot;end_time&quot;:&quot;2025-12-09T04:13:22.060071&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:22.039683&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CONFIGURACIÓN</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros (LCG estándar de C++ minstd_rand)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>lgc_a, lgc_c, lgc_m <span class="op">=</span> <span class="dv">48271</span>, <span class="dv">0</span>, <span class="dv">2</span><span class="op">**</span><span class="dv">31</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Semilla</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>rnd_seed <span class="op">=</span> <span class="dv">2371</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="parte-1---generación-de-números-pseudoaleatorios-y-monte-carlo" class="level3">
<h3 class="anchored" data-anchor-id="parte-1---generación-de-números-pseudoaleatorios-y-monte-carlo">Parte 1 - Generación de Números Pseudoaleatorios y Monte Carlo</h3>
<section id="implementación-de-un-generador-congruencial-lineal-lcg" class="level4">
<h4 class="anchored" data-anchor-id="implementación-de-un-generador-congruencial-lineal-lcg">Implementación de un Generador Congruencial Lineal (LCG)</h4>
<p>La implementación de un Generador Congruencial Lineal (LCG) se fundamenta en un algoritmo iterativo y determinista regido por la relación de recurrencia</p>
<p><span class="math display">\[X_{n+1} = (aX_n + c) \mod m\]</span></p>
<p>mediante la cual se produce una secuencia de números pseudoaleatorios a partir de un valor inicial denominado semilla (<span class="math inline">\(X_0\)</span>). El proceso requiere la definición de tres constantes enteras —el multiplicador (<span class="math inline">\(a\)</span>), el incremento (<span class="math inline">\(c\)</span>) y el módulo (<span class="math inline">\(m\)</span>)— y opera calculando el siguiente valor de la serie al multiplicar el estado actual por <span class="math inline">\(a\)</span>, sumar <span class="math inline">\(c\)</span> y obtener el residuo de la división por <span class="math inline">\(m\)</span>, resultando en una sucesión periódica que, si bien carece de aleatoriedad verdadera, es computacionalmente eficiente y totalmente reproducible si se mantienen los mismos parámetros iniciales.</p>
<p>Al usar operaciones aritméticas básicas, es extremadamente rápido computacionalmente. Como hay un número finito de resultados posibles (de <span class="math inline">\(0\)</span> a <span class="math inline">\(m-1\)</span>), la secuencia eventualmente se repetirá. A esto se le llama el “periodo”. Por otra parte si se usa la misma semilla (<span class="math inline">\(X_0\)</span>), se obtendrá exactamente la misma secuencia de números. Esto es útil para “debugging” o reproducir simulaciones científicas, pero malo para la seguridad. No es seguro criptográficamente: No se debe usar para contraseñas o claves de seguridad, ya que es relativamente fácil predecir los siguientes números analizando la secuencia previa.</p>
<div id="666874e9" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.016728,&quot;end_time&quot;:&quot;2025-12-09T04:13:22.105240&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:22.088512&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementación del LCG</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lcg_generator(seed, a, c, m, n):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    numbers <span class="op">=</span> []</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> seed</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> (a <span class="op">*</span> x <span class="op">+</span> c) <span class="op">%</span> m</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normalizar a [0, 1]</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        numbers.append(x <span class="op">/</span> m) </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> numbers</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Para evaluar la calidad de los números pseudoaleatorios generados por uel LCG, es necesario verificar dos propiedades fundamentales: Uniformidad e Independencia. A continuación, se detalla la lógica de implementación y el código en Python para las tres herramientas solicitadas.</p>
</section>
<section id="histograma" class="level4">
<h4 class="anchored" data-anchor-id="histograma">Histograma</h4>
<p>El histograma visualiza la distribución de frecuencia de los números generados. Para un buen generador, esperamos una distribución uniforme (plana), lo que significa que cada intervalo del rango tiene aproximadamente la misma probabilidad de contener un número.</p>
<div id="6de0ab42" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.31211,&quot;end_time&quot;:&quot;2025-12-09T04:13:22.449385&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:22.137275&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>datos <span class="op">=</span> lcg_generator(seed<span class="op">=</span>rnd_seed, a<span class="op">=</span>lgc_a, c<span class="op">=</span>lgc_c, m<span class="op">=</span>lgc_m, n<span class="op">=</span><span class="dv">5000</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">3</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>plt.hist(datos, bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histograma de Uniformidad'</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La presencia de alturas similares en todas las barras (“bins”) del histograma indica que el Generador Congruencial Lineal (LCG) está cumpliendo satisfactoriamente con la propiedad de uniformidad, lo que significa que cada sub-intervalo del rango tiene una probabilidad casi idéntica de contener un número generado. Esta distribución “plana” o rectangular sugiere que el algoritmo recorre el espacio muestral sin sesgos evidentes ni favoritismos hacia ciertos valores; sin embargo, es crucial notar que estas variaciones leves deben ser producto del azar natural (pequeñas fluctuaciones son esperadas y saludables), y aunque este patrón valida la equiprobabilidad, por sí solo no garantiza la independencia de los datos (ausencia de patrones secuenciales), por lo que un histograma visualmente equilibrado es una condición necesaria, pero no suficiente, para aprobar un generador.</p>
</section>
<section id="runs-test-prueba-de-rachascorridas" class="level4">
<h4 class="anchored" data-anchor-id="runs-test-prueba-de-rachascorridas">Runs Test (Prueba de Rachas/Corridas)</h4>
<p>Esta prueba verifica la independencia analizando la secuencia de oscilaciones. Una “racha” es una secuencia ininterrumpida de números crecientes o decrecientes.</p>
<p>Para la lógica de Implementación (con Corridas Arriba/Abajo) se toma la secuencia <span class="math inline">\(u_1, u_2, \dots, u_n\)</span>. Se crea una nueva secuencia binaria basada en si el valor actual es mayor o menor que el anterior (<span class="math inline">\(+\)</span> si <span class="math inline">\(u_i &lt; u_{i+1}\)</span>, <span class="math inline">\(-\)</span> si <span class="math inline">\(u_i &gt; u_{i+1}\)</span>). Luego se cuenta el número total de rachas (cambios de <span class="math inline">\(+\)</span> a <span class="math inline">\(-\)</span> o viceversa). Se calcual el estadístico Z comparando el número de rachas obtenido con el esperado teóricamente usando la aproximación normal para muestras grandes (<span class="math inline">\(N &gt; 20\)</span>).</p>
<p><span class="math display">\[\mu_R = \frac{2N - 1}{3}\]</span> <span class="math display">\[\sigma_R^2 = \frac{16N - 29}{90}\]</span> <span class="math display">\[Z = \frac{R - \mu_R}{\sigma_R}\]</span></p>
<p>Si el valor absoluto de <span class="math inline">\(Z\)</span> (<span class="math inline">\(|Z|\)</span>) es mayor que el valor crítico (ej. <span class="math inline">\(1.96\)</span> para un 95% de confianza), se rechaza la hipótesis de independencia.</p>
<div id="25dbd830" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.021794,&quot;end_time&quot;:&quot;2025-12-09T04:13:22.520776&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:22.498982&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Runs Test</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>runs <span class="op">=</span> <span class="dv">1</span> <span class="co"># Empieza la primera racha</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(datos) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Si la dirección cambia respecto al anterior, es nueva racha</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        prev_diff <span class="op">=</span> datos[i] <span class="op">-</span> datos[i<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        curr_diff <span class="op">=</span> datos[i<span class="op">+</span><span class="dv">1</span>] <span class="op">-</span> datos[i]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si el producto es negativo, hubo cambio de signo (dirección)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prev_diff <span class="op">*</span> curr_diff <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            runs <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>expected_runs <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">len</span>(datos) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">3</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Rachas observadas: </span><span class="sc">{</span>runs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Rachas esperadas: </span><span class="sc">{</span>expected_runs<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rachas observadas: 3325
Rachas esperadas: 3333.00</code></pre>
</div>
</div>
<p>La cercanía entre las rachas observadas y las esperadas revela una discrepancia numérica mínima, lo cual sugiere que el Generador Congruencial Lineal (LCG) cumple satisfactoriamente con la propiedad de independencia estadística. Este resultado indica que la secuencia de números fluctúa (asciende y desciende) con una frecuencia consistente con el azar puro, descartando la presencia de patrones de dependencia serial; al no existir una desviación significativa (la diferencia es muy pequeña considerando el tamaño de la muestra), el valor estadístico <span class="math inline">\(Z\)</span> resultante sería muy cercano a cero, lo que impide rechazar la hipótesis nula y permite concluir que los datos no están correlacionados entre sí, validando el motor como un generador robusto en términos de oscilación.</p>
</section>
<section id="gráfico-de-triples-spectral-test-visual" class="level4">
<h4 class="anchored" data-anchor-id="gráfico-de-triples-spectral-test-visual">Gráfico de Triples (Spectral Test Visual)</h4>
<p>Esta es una visualización en 3D para detectar correlaciones seriales. Los generadores LCG malos tienden a concentrar los puntos en planos discretos en lugar de llenar el espacio uniformemente (fenómeno conocido como planos de Marsaglia).</p>
<p>El gráfico de triples opera bajo la lógica de visualización del espacio de fases para detectar correlaciones seriales de largo alcance, mapeando tríadas consecutivas de la secuencia generada <span class="math inline">\((u_n, u_{n+1}, u_{n+2})\)</span> como coordenadas espaciales <span class="math inline">\((x, y, z)\)</span> en un cubo tridimensional. La premisa fundamental es que, si los números fueran verdaderamente independientes, los puntos deberían llenar el volumen de manera caótica y uniforme como una “nube de polvo”; sin embargo, debido a la naturaleza lineal de la fórmula <span class="math inline">\(X_{n+1} = (aX_n + c)\)</span>, los LCGs deficientes exhiben una estructura cristalina donde los puntos se alinean rígidamente en un número finito de planos paralelos (fenómeno conocido como planos de Marsaglia), revelando visualmente que la aleatoriedad es solo aparente y que existen dependencias matemáticas estrictas entre valores sucesivos.</p>
<div id="25542a92" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.259229,&quot;end_time&quot;:&quot;2025-12-09T04:13:22.846302&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:22.587073&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto estira el lienzo hacia la derecha.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>, projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear tripletas</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> datos[:<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>y_vals <span class="op">=</span> datos[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>z_vals <span class="op">=</span> datos[<span class="dv">2</span>:]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ax.scatter(x_vals, y_vals, z_vals, s<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Gráfico de Triples (Correlación Serial)'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'U(i)'</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'U(i+1)'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">'U(i+2)'</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">0.75</span>, left<span class="op">=</span><span class="fl">0.1</span>, bottom<span class="op">=</span><span class="fl">0.1</span>, top<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La observación de una nube de puntos dispersa y volumétrica que llena el cubo de manera homogénea se interpreta como una validación exitosa de la calidad espectral del generador, indicando que la correlación serial entre ternas consecutivas <span class="math inline">\((u_n, u_{n+1}, u_{n+2})\)</span> es despreciable o inexistente para fines prácticos. Visualmente, esto contrasta con los generadores deficientes que agrupan los puntos en “rebanadas” o planos paralelos separados; por el contrario, una distribución uniforme implica que el algoritmo posee un periodo lo suficientemente largo y unos parámetros adecuados para “romper” la estructura reticular visible, garantizando que no existen dependencias geométricas fuertes y haciendo al generador apto para simulaciones Monte Carlo multidimensionales.</p>
<p>La estimación del valor de <span class="math inline">\(\pi\)</span> mediante el método de Monte Carlo utiliza el Generador Congruencial Lineal (LCG) para producir pares de coordenadas <span class="math inline">\((x, y)\)</span> uniformemente distribuidas en el intervalo <span class="math inline">\([0, 1)\)</span>, simulando el lanzamiento aleatorio de puntos sobre un cuadrado unitario que contiene un cuarto de círculo inscrito. El procedimiento se fundamenta en la geometría probabilística: dado que el área del cuarto de círculo es <span class="math inline">\(\pi/4\)</span> y el área del cuadrado es <span class="math inline">\(1\)</span>, la probabilidad de que un punto caiga dentro del círculo es exactamente <span class="math inline">\(\pi/4\)</span>; por consiguiente, al verificar cuántos puntos cumplen la condición <span class="math inline">\(x^2 + y^2 \le 1\)</span> y dividir esa cantidad por el número total de puntos generados, se obtiene una proporción que, multiplicada por <span class="math inline">\(4\)</span>, aproxima el valor de <span class="math inline">\(\pi\)</span>, sirviendo esto a su vez como una prueba funcional de la calidad del LCG, ya que un generador sesgado o correlacionado (como el que forma líneas en el gráfico de triples) arrojará un valor de <span class="math inline">\(\pi\)</span> incorrecto al no cubrir el área uniformemente.</p>
<p>Lógica de Implementación 1. Generación de Pares: Se utiliza el LCG para obtener dos números consecutivos normalizados (<span class="math inline">\(u_i, u_{i+1}\)</span>) que actúan como coordenadas <span class="math inline">\(x\)</span> e <span class="math inline">\(y\)</span>. 2. Condición Geométrica: Se calcula la distancia al origen (<span class="math inline">\(d = x^2 + y^2\)</span>). 3. Conteo: Si <span class="math inline">\(d \le 1\)</span>, el punto está “dentro” del círculo (Acierto). 4. Cálculo Final: <span class="math inline">\(\pi \approx 4 \times \frac{\text{Aciertos}}{\text{Total de Puntos}}\)</span>.</p>
<div id="e39c3dce" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.327027,&quot;end_time&quot;:&quot;2025-12-09T04:13:23.246697&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:22.919670&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función Monte Carlo con Gráfico y Retorno de Valor</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimar_y_graficar_pi(n_puntos):   </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Se generan los números necesarios (2 por punto)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    s, a, c, m <span class="op">=</span> rnd_seed, lgc_a, lgc_c, lgc_m</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    lista_completa <span class="op">=</span> lcg_generator(s, a, c, m , n_puntos <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    iterador_numeros <span class="op">=</span> <span class="bu">iter</span>(lista_completa)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Listas para guardar coordenadas (visualización)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    inside_x, inside_y <span class="op">=</span> [], []</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    outside_x, outside_y <span class="op">=</span> [], []</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    dentro_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_puntos):</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extraer par (x, y)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">next</span>(iterador_numeros)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> <span class="bu">next</span>(iterador_numeros)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clasificar</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> y<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;=</span> <span class="fl">1.0</span>:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            dentro_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            inside_x.append(x)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            inside_y.append(y)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            outside_x.append(x)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            outside_y.append(y)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimación del valor</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    pi_estimado <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> (dentro_count <span class="op">/</span> n_puntos)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GRAFICO CONTEO</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Puntos dentro (Azul) y fuera (Rojo)</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    plt.scatter(inside_x, inside_y, color<span class="op">=</span><span class="st">'dodgerblue'</span>, s<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Dentro'</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    plt.scatter(outside_x, outside_y, color<span class="op">=</span><span class="st">'salmon'</span>, s<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Fuera'</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arco del círculo (estético)</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> np.linspace(<span class="dv">0</span>, np.pi<span class="op">/</span><span class="dv">2</span>, <span class="dv">100</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.cos(t), np.sin(t), <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="dv">0</span>, <span class="dv">1</span>)<span class="op">;</span> plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Monte Carlo LCG (N=</span><span class="sc">{</span>n_puntos<span class="sc">}</span><span class="ss">)</span><span class="ch">\n</span><span class="ss">Pi estimado: </span><span class="sc">{</span>pi_estimado<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- RETORNO ESTIMACIÓN ---</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pi_estimado</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejecución con diez mil puntos</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>pi_val <span class="op">=</span> estimar_y_graficar_pi(n)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Puntos procesados: </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Valor estimado de Pi: </span><span class="sc">{</span>pi_val<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Diferencia real: </span><span class="sc">{</span><span class="bu">abs</span>(pi_val <span class="op">-</span> <span class="fl">3.14159265</span>)<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Puntos procesados: 10000
Valor estimado de Pi: 3.1496
Diferencia real: 0.008007</code></pre>
</div>
</div>
</section>
</section>
<section id="parte-2---metropolishastings-y-bayesian-inference" class="level3">
<h3 class="anchored" data-anchor-id="parte-2---metropolishastings-y-bayesian-inference">Parte 2 - Metropolis–Hastings y Bayesian Inference</h3>
<p>La relación entre el algoritmo de Metropolis-Hastings y la inferencia bayesiana es fundamentalmente instrumental, donde el primero actúa como la solución computacional para los desafíos analíticos planteados por el segundo. La inferencia bayesiana busca estimar la distribución posterior de parámetros desconocidos, denotada como <span class="math inline">\(P(\theta | D)\)</span>, mediante la aplicación del Teorema de Bayes. No obstante, este proceso conlleva frecuentemente el cálculo de una constante de normalización —la evidencia marginal— que implica resolver integrales multidimensionales analíticamente intratables, lo cual impide la obtención directa de la distribución posterior en modelos complejos.</p>
<p>El algoritmo de Metropolis-Hastings, perteneciente a la familia de métodos de Monte Carlo vía Cadenas de Markov (MCMC), se distingue por su capacidad para generar muestras de una distribución de probabilidad objetivo sin necesidad de conocer su constante de normalización. El algoritmo opera construyendo una cadena de Markov que converge asintóticamente a la distribución deseada, requiriendo únicamente una función que sea proporcional a dicha densidad objetivo para evaluar los ratios de aceptación de las muestras propuestas.</p>
<p>En consecuencia, la conexión crítica reside en que la distribución posterior no normalizada en la estadística bayesiana es proporcional al producto de la función de verosimilitud y la distribución a priori (<span class="math inline">\(Likelihood \times Prior\)</span>). Dado que Metropolis-Hastings puede operar bajo condiciones de proporcionalidad, este algoritmo permite muestrear la distribución posterior y realizar inferencias sobre los parámetros sin tener que calcular la integral de la evidencia marginal, haciendo viable el análisis bayesiano en escenarios de alta dimensionalidad donde las soluciones cerradas son imposibles.</p>
<section id="posterior-beta-analítica" class="level4">
<h4 class="anchored" data-anchor-id="posterior-beta-analítica">Posterior beta analítica</h4>
<p>Sea una moneda con 10 lanzamientos y 7 caras, para obtener una posterior <span class="math inline">\(\text{Beta}(8,4)\)</span> a partir de 7 caras (<span class="math inline">\(k=7\)</span>) y 3 cruces (<span class="math inline">\(n-k=3\)</span>), debemos asumir un prior Uniforme o <span class="math inline">\(\text{Beta}(1,1)\)</span>. En la inferencia Bayesiana, demode que si se usa un Prior Beta y un Likelihood Binomial, el Posterior siempre es otra Beta:</p>
<ul>
<li>Likelihood (Verosimilitud): <span class="math inline">\(P(X|\theta) \propto \theta^7 (1-\theta)^3\)</span></li>
<li>Prior (A priori): <span class="math inline">\(P(\theta) \sim \text{Beta}(1,1) \propto 1\)</span></li>
<li>Posterior (A posteriori): <span class="math inline">\(P(\theta|X) \propto \theta^{7+1-1} (1-\theta)^{3+1-1} = \theta^7 (1-\theta)^3 \rightarrow \text{Beta}(8,4)\)</span></li>
</ul>
<p>En términos de Python:</p>
<div id="87b106e2" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:8.448559,&quot;end_time&quot;:&quot;2025-12-09T04:13:31.744442&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:23.295883&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones del modelo</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_prior(theta):</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Prior Beta(1,1) (Uniforme en [0, 1]).</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna 0 si está en rango (log(1)), -inf si no.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> theta <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.inf</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_likelihood(theta, heads, trials):</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Log-Likelihood Binomial.</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> theta <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> theta <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span>np.inf</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Proporcional a theta^k * (1-theta)^(n-k)</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (heads <span class="op">*</span> np.log(theta)) <span class="op">+</span> ((trials <span class="op">-</span> heads) <span class="op">*</span> np.log(<span class="dv">1</span> <span class="op">-</span> theta))</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_posterior(theta, heads, trials):</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    lp <span class="op">=</span> log_prior(theta)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> np.isfinite(lp):</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span>np.inf</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lp <span class="op">+</span> log_likelihood(theta, heads, trials)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Como el objetivo es obtener exactamente <span class="math inline">\(\text{Beta}(8,4)\)</span> con 7 caras y 3 cruces, implícitamente se está asumiendo que no se aporta información previa (el 1 inicial de la Beta actúa como un “neutro” o punto de partida cero en términos de influencia).</p>
<div id="f9b34204" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:3.0301,&quot;end_time&quot;:&quot;2025-12-09T04:13:34.822760&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:31.792660&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración del Problema</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(rnd_seed)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos observados: 10 lanzamientos, 7 caras</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>n_trials <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>n_heads <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros del algoritmo MCMC</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>n_chains <span class="op">=</span> <span class="dv">4</span>        <span class="co"># Solicitado explícitamente para R-hat</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> <span class="dv">5000</span>    <span class="co"># Muestras por cadena</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>burnin <span class="op">=</span> <span class="dv">1000</span>       <span class="co"># Periodo de calentamiento (burn-in)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>step_size <span class="op">=</span> <span class="fl">0.1</span>     <span class="co"># Desviación estándar de la propuesta (Proposal width)</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Algoritmo Metropolis-Hastings</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metropolis_hastings(n_samples, n_chains, heads, trials, step_size):</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    chains <span class="op">=</span> []</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Iniciando muestreo con </span><span class="sc">{</span>n_chains<span class="sc">}</span><span class="ss"> cadenas..."</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chain_idx <span class="kw">in</span> <span class="bu">range</span>(n_chains):</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        samples <span class="op">=</span> []</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Punto de inicio aleatorio para cada cadena</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        current_theta <span class="op">=</span> np.random.uniform(<span class="fl">0.1</span>, <span class="fl">0.9</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        current_log_post <span class="op">=</span> log_posterior(current_theta, heads, trials)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_samples <span class="op">+</span> burnin):</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 1. Propuesta: Random Walk (Normal centrada en theta actual)</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            proposal <span class="op">=</span> np.random.normal(current_theta, step_size)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 2. Calcular Log-Posterior de la propuesta</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>            proposal_log_post <span class="op">=</span> log_posterior(proposal, heads, trials)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 3. Ratio de Aceptación (en escala logarítmica para estabilidad)</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># r = p(new)/p(old). log(r) = log(p(new)) - log(p(old))</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            log_ratio <span class="op">=</span> proposal_log_post <span class="op">-</span> current_log_post</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 4. Decisión de aceptación</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> np.log(np.random.rand()) <span class="op">&lt;</span> log_ratio:</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                current_theta <span class="op">=</span> proposal</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                current_log_post <span class="op">=</span> proposal_log_post</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Guardar solo después del burn-in</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&gt;=</span> burnin:</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                samples.append(current_theta)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        chains.append(samples)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Cadena </span><span class="sc">{</span>chain_idx <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss"> completada."</span>)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(chains)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejecutar el sampler</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>samples, chains, heads, trials <span class="op">=</span> n_samples, n_chains, n_heads, n_trials</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>chains <span class="op">=</span> metropolis_hastings(samples, chains, heads, trials, step_size)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir a objeto InferenceData de Arviz para facilitar diagnósticos</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>idata <span class="op">=</span> az.from_dict(posterior<span class="op">=</span>{<span class="st">"theta"</span>: chains})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iniciando muestreo con 4 cadenas...
Cadena 1 completada.
Cadena 2 completada.
Cadena 3 completada.
Cadena 4 completada.</code></pre>
</div>
</div>
</section>
<section id="diagnósticos-obligtatorios" class="level4">
<h4 class="anchored" data-anchor-id="diagnósticos-obligtatorios">Diagnósticos Obligtatorios</h4>
</section>
<section id="traceplot" class="level4">
<h4 class="anchored" data-anchor-id="traceplot">Traceplot</h4>
<p>El Traceplot permite visualizar la evolución temporal de las cadenas de Markov, facilitando la verificación inmediata de la convergencia asintótica y la calidad del muestreo. A través de este gráfico se evalúa si el algoritmo ha alcanzado la estacionariedad (oscilando alrededor de un valor estable sin tendencias) y si existe una mezcla adecuada del espacio de parámetros (exploración eficiente), lo cual es indispensable para validar que las muestras obtenidas son representativas de la distribución posterior objetivo y descartar problemas como una alta autocorrelación o una configuración errónea del tamaño de paso.</p>
<div id="71405aad" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:2.986981,&quot;end_time&quot;:&quot;2025-12-09T04:13:37.858119&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:34.871138&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Traceplot y Densidad (Histograma implícito en kde)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Arviz genera automáticamente </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Traceplot a la derecha y la densidad a la izquierda</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>az.plot_trace(idata)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>graph_title <span class="op">=</span> <span class="st">"Traceplot (Derecha) y Densidad Posterior (Izquierda)"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.suptitle(graph_title, y<span class="op">=</span><span class="fl">2.05</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(top<span class="op">=</span><span class="fl">.75</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>El gráfico confirma la convergencia exitosa y robusta del algoritmo Metropolis-Hastings, validando la calidad de la inferencia realizada. En el panel derecho (Traceplot), se observa una oscilación densa y constante alrededor de un eje central sin tendencias visibles —patrón “oruga peluda”—, lo cual demuestra que las cuatro cadenas han alcanzado la estacionariedad y exploran el espacio de parámetros con una mezcla eficiente y homogénea. Corroborando esto, el panel izquierdo (Densidad Posterior) exhibe una superposición casi perfecta de las distribuciones estimadas por cada cadena, indicando consistencia interna (bajo R-hat) y revelando una moda centrada aproximadamente en 0.7, valor que coincide con el máximo teórico esperado para la distribución Beta(8,4).</p>
</section>
<section id="autocorrelación" class="level4">
<h4 class="anchored" data-anchor-id="autocorrelación">Autocorrelación</h4>
<p>El análisis de la autocorrelación permite cuantificar la dependencia serial inherente entre las muestras generadas por la cadena de Markov, dado que los algoritmos MCMC producen, por definición, observaciones correlacionadas en lugar de independientes. Este diagnóstico es crítico para evaluar la eficiencia del muestreo (mixing), ya que una persistencia alta de la correlación a través de múltiples retardos (lags) indica una exploración lenta del espacio de parámetros y reduce el tamaño de muestra efectivo (ESS), lo que alertaría sobre la necesidad de incrementar el número de iteraciones o ajustar el tamaño de paso para garantizar que la inferencia estadística sobre la posterior sea fiable y precisa.</p>
<div id="14daed84" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.692357,&quot;end_time&quot;:&quot;2025-12-09T04:13:38.658597&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:37.966240&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Autocorrelación</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>az.plot_autocorr(idata, max_lag<span class="op">=</span><span class="dv">20</span>, ax<span class="op">=</span>axes)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Gráfico de Autocorrelación"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Los gráficos de autocorrelación revelan una persistente dependencia serial entre las muestras sucesivas, evidenciada por un decaimiento lento de las barras que mantienen valores significativos incluso después de 15 a 20 retardos (<em>lags</em>). Este comportamiento, consistente en las cuatro cadenas analizadas, indica una eficiencia de mezcla (<em>mixing</em>) moderada y una exploración del espacio de parámetros con cierta “viscosidad”, lo cual reduce el Tamaño de Muestra Efectivo (ESS) e implica que, para fines de inferencia estadística robusta, la cantidad de información independiente real es considerablemente menor al número total de iteraciones computadas.</p>
</section>
<section id="histograma-vs-analítica-beta84" class="level4">
<h4 class="anchored" data-anchor-id="histograma-vs-analítica-beta84">Histograma vs Analítica Beta(8,4)</h4>
<p>La superposición del histograma de frecuencias empíricas frente a la curva analítica de la distribución Beta es una prueba definitiva de validación, aprovechando que el modelo Beta-Binomial posee una solución cerrada conocida que sirve como “verdad fundamental” (<em>ground truth</em>). Este diagnóstico visual permite confirmar rigurosamente que el algoritmo Metropolis-Hastings está muestreando fielmente de la distribución objetivo y no de una aproximación errónea, verificando así que la lógica computacional, la función de verosimilitud y el mecanismo de aceptación/rechazo han sido implementados con exactitud matemática y que el muestreador recupera la geometría correcta de la posterior sin sesgos.</p>
<div id="41b8f731" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.361407,&quot;end_time&quot;:&quot;2025-12-09T04:13:39.128773&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:38.767366&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma vs Analítica Beta(8,4)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplanar las cadenas para el histograma</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>flat_samples <span class="op">=</span> chains.flatten()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograma de muestras MCMC</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.hist(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    flat_samples,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    density<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'skyblue'</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Muestras MCMC'</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Curva Analítica Real Beta(8,4)</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1000</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior analítica: 7 caras + 1, 3 cruces + 1</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>pdf_true <span class="op">=</span> stats.beta.pdf(x, <span class="dv">8</span>, <span class="dv">4</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>plt.plot(x, pdf_true, <span class="st">'r-'</span>, lw<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'Analítica: Beta(8,4)'</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diagnóstico: Histograma MCMC vs Curva Real Beta(8,4)"</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r"</span><span class="dv">$</span><span class="ch">\t</span><span class="vs">heta</span><span class="dv">$</span><span class="vs"> </span><span class="kw">(</span><span class="vs">Probabilidad de cara</span><span class="kw">)</span><span class="vs">"</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Densidad"</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>El gráfico evidencia una correspondencia altamente satisfactoria entre la distribución empírica generada por el algoritmo (histograma azul) y la solución analítica teórica (curva roja), demostrando la exactitud de la implementación. La alineación precisa de las frecuencias de las barras con el perfil de la función de densidad Beta(8,4) confirma que el muestreador ha logrado capturar fielmente la estructura probabilística de la posterior, reproduciendo correctamente tanto la ubicación de la moda en torno a 0.7 como la dispersión asociada, lo cual valida que las muestras obtenidas son estadísticamente representativas de la distribución objetivo y legitima el uso de la simulación para la inferencia paramétrica.</p>
</section>
<section id="r-hat-con-4-cadenas-y-ess-effective-sample-size" class="level4">
<h4 class="anchored" data-anchor-id="r-hat-con-4-cadenas-y-ess-effective-sample-size">R-hat con 4 cadenas y ESS (Effective Sample Size)</h4>
<p>Las métricas R-hat y ESS (Tamaño de Muestra Efectivo) proporcionan una validación cuantitativa y objetiva de la fiabilidad y precisión de la simulación, superando las limitaciones de la inspección visual. El estadístico R-hat resulta indispensable al utilizar múltiples cadenas para verificar matemáticamente la convergencia global, asegurando a través de la comparación de varianzas que el algoritmo no ha quedado atrapado en óptimos locales; simultáneamente, el ESS es crítico para cuantificar el volumen real de información independiente generada descontando la autocorrelación, garantizando así que la estimación de la posterior posea un error estándar de Monte Carlo lo suficientemente reducido para ser estadísticamente válida.</p>
<div id="87469907" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.335835,&quot;end_time&quot;:&quot;2025-12-09T04:13:39.581093&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:39.245258&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R-hat y ESS (Effective Sample Size)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> az.summary(idata, kind<span class="op">=</span><span class="st">"diagnostics"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DIAGNÓSTICOS NUMÉRICOS"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificación explicita de valores</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>r_hat_val <span class="op">=</span> summary.loc[<span class="st">'theta'</span>, <span class="st">'r_hat'</span>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>ess_val <span class="op">=</span> summary.loc[<span class="st">'theta'</span>, <span class="st">'ess_bulk'</span>]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R-hat obtenido (Ideal &lt; 1.01): </span><span class="sc">{</span>r_hat_val<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"ESS (Effective Sample Size): </span><span class="sc">{</span>ess_val<span class="sc">:.1f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------
DIAGNÓSTICOS NUMÉRICOS
----------------------------------------
       mcse_mean  mcse_sd  ess_bulk  ess_tail  r_hat
theta      0.003    0.002    1691.0    1971.0    1.0
----------------------------------------
R-hat obtenido (Ideal &lt; 1.01): 1.0000
ESS (Effective Sample Size): 1691.0</code></pre>
</div>
</div>
<p>Los diagnósticos numéricos validan la robustez técnica de la simulación, destacando un estadístico R-hat de 1.0 que confirma la convergencia perfecta de las cadenas y su indistinguibilidad estadística. Por su parte, el Tamaño de Muestra Efectivo (ESS) de 1691.0, aunque inferior al total de iteraciones debido a la correlación serial, resulta suficiente para garantizar estimaciones estables de la tendencia central, lo cual, sumado a un error estándar de Monte Carlo (mcse) marginal de 0.003, asegura que la precisión de la inferencia sobre la posterior es elevada y que el error introducido por el método de muestreo es despreciable.</p>
</section>
</section>
<section id="parte-3---simulación-de-eventos-discretos-mm1-o-mmc" class="level3">
<h3 class="anchored" data-anchor-id="parte-3---simulación-de-eventos-discretos-mm1-o-mmc">Parte 3 - Simulación de Eventos Discretos (M/M/1 o M/M/c)</h3>
<p>Para implementar esta simulación, el motor central debe basarse en una <strong>Lista de Eventos Futuros (LEF)</strong> ordenada cronológicamente y una variable de reloj (<span class="math inline">\(T_{now}\)</span>). El tiempo no avanza de forma continua, sino que “salta” discretamente al instante del evento más próximo en la lista. Inicialmente, se genera la primera llegada aleatoria (usando la tasa <span class="math inline">\(\lambda=10\)</span>) y se inserta en la LEF; el ciclo de simulación consiste en extraer repetidamente el evento de menor tiempo de la lista, actualizar el reloj a ese instante y ejecutar la lógica de cambio de estado correspondiente hasta que <span class="math inline">\(T_{now}\)</span> supere las 8 horas.</p>
<p>La lógica de estado maneja dos eventos principales: Llegada y Salida. Al procesar una Llegada, se programa inmediatamente la siguiente llegada futura y se evalúan los servidores: si hay alguno libre (de los <span class="math inline">\(c\)</span> disponibles), se ocupa y se calcula una duración de servicio (con tasa <span class="math inline">\(\mu=4\)</span>) para insertar un evento de Salida en la LEF; si todos están ocupados, se incrementa el contador de la cola. Por otro lado, al procesar una Salida, se libera el servidor, pero si la cola no está vacía, se decrementa inmediatamente para ingresar al siguiente cliente al servicio, generando su respectivo evento de finalización futuro.</p>
<section id="simulación-8-horas-de-un-sistemas-de-colas" class="level4">
<h4 class="anchored" data-anchor-id="simulación-8-horas-de-un-sistemas-de-colas">Simulación 8 horas de un sistemas de colas</h4>
<p>Esta es una implementaciónen Python de una simulación de eventos discretos (DES) utilizando una Lista de Eventos Futuros (LEF) implementada con una cola de prioridad (heapq). El código está diseñado para soportar tanto M/M/1 (1 servidor) como M/M/c (múltiples servidores), pero además tenemos estos parámetros:</p>
<ul>
<li><span class="math inline">\(\lambda\)</span> (Tasa de llegadas): 10 clientes/hora.</li>
<li><span class="math inline">\(\mu\)</span> (Tasa de servicio): 4 clientes/hora.</li>
<li><span class="math inline">\(c\)</span> (Servidores): Variable.</li>
</ul>
<p>Es importante resaltar que si usamos <span class="math inline">\(c=1\)</span> (M/M/1), el sistema será inestable porque la tasa de llegada (10) es mayor que la capacidad de servicio (4). La cola crecerá infinitamente. Para un sistema estable, necesitamos <span class="math inline">\(c \ge 3\)</span> (capacidad 12 &gt; 10). Por esto se ha configurado el código por defecto con NUM_SERVIDORES = 3, pero puede cambiarse a 1 para observar cómo se satura.</p>
<div id="28ab07e0" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.043363,&quot;end_time&quot;:&quot;2025-12-09T04:13:39.783313&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:39.739950&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> heapq</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.animation <span class="im">as</span> animation</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SimulacionMMC_Log:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, tiempo_max, tasa_llegada,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                 tasa_servicio, n_servidores):</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ajustamos los parámetros iniciales</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tiempo_max <span class="op">=</span> tiempo_max</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tasa_llegada <span class="op">=</span> tasa_llegada</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tasa_servicio <span class="op">=</span> tasa_servicio</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_servidores <span class="op">=</span> n_servidores</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estado del sistema</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.reloj <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_en_cola <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.servidores_ocupados <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lef <span class="op">=</span> []  <span class="co"># Lista de Eventos Futuros</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estadísticas y Acumuladores</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total_llegadas <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total_atendidos <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.area_cola <span class="op">=</span> <span class="fl">0.0</span>      <span class="co"># Para calcular Lq</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.area_ocupados <span class="op">=</span> <span class="fl">0.0</span>  <span class="co"># Para calcular utilización</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tiempo_ultimo_evento <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Historial para Animación</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.historia <span class="op">=</span> [(<span class="fl">0.0</span>, <span class="dv">0</span>, <span class="dv">0</span>)]</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> actualizar_estadisticas(<span class="va">self</span>, tiempo_actual):</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Calcula áreas bajo la curva antes de cambiar estado."""</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>        delta_t <span class="op">=</span> tiempo_actual <span class="op">-</span> <span class="va">self</span>.tiempo_ultimo_evento</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.area_cola <span class="op">+=</span> <span class="va">self</span>.num_en_cola <span class="op">*</span> delta_t</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.area_ocupados <span class="op">+=</span> <span class="va">self</span>.servidores_ocupados <span class="op">*</span> delta_t</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tiempo_ultimo_evento <span class="op">=</span> tiempo_actual</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> correr(<span class="va">self</span>):</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Programar primera llegada</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        t_llegada <span class="op">=</span> random.expovariate(<span class="va">self</span>.tasa_llegada)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        heapq.heappush(<span class="va">self</span>.lef, (t_llegada, <span class="dv">0</span>))  <span class="co"># 0 = LLEGADA</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>        msg <span class="op">=</span> (<span class="ss">f"--- Iniciando Simulación M/M/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>n_servidores<span class="sc">}</span><span class="ss"> "</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>               <span class="ss">f"por </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>tiempo_max<span class="sc">}</span><span class="ss"> horas ---"</span>)</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(msg)</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.reloj <span class="op">&lt;</span> <span class="va">self</span>.tiempo_max <span class="kw">and</span> <span class="va">self</span>.lef:</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>            tiempo_evento, tipo_evento <span class="op">=</span> heapq.heappop(<span class="va">self</span>.lef)</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tiempo_evento <span class="op">&gt;</span> <span class="va">self</span>.tiempo_max:</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Actualizar hasta tiempo final exacto</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.actualizar_estadisticas(<span class="va">self</span>.tiempo_max)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.reloj <span class="op">=</span> <span class="va">self</span>.tiempo_max</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 1. Actualizar estadísticas</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.actualizar_estadisticas(tiempo_evento)</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 2. Avanzar reloj</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.reloj <span class="op">=</span> tiempo_evento</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 3. Procesar evento</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tipo_evento <span class="op">==</span> <span class="dv">0</span>:  <span class="co"># LLEGADA</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.procesar_llegada()</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:  <span class="co"># SALIDA</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.procesar_salida()</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 4. Guardar foto para la animación</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.historia.append((</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.reloj,</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.num_en_cola,</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.servidores_ocupados</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># AL FINALIZAR EL BUCLE: MOSTRAR RESULTADOS</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.reporte_final()</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> procesar_llegada(<span class="va">self</span>):</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total_llegadas <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>        prox <span class="op">=</span> <span class="va">self</span>.reloj <span class="op">+</span> random.expovariate(<span class="va">self</span>.tasa_llegada)</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>        heapq.heappush(<span class="va">self</span>.lef, (prox, <span class="dv">0</span>))</span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.servidores_ocupados <span class="op">&lt;</span> <span class="va">self</span>.n_servidores:</span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.servidores_ocupados <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>            t_salida <span class="op">=</span> <span class="va">self</span>.reloj <span class="op">+</span> random.expovariate(</span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tasa_servicio</span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>            heapq.heappush(<span class="va">self</span>.lef, (t_salida, <span class="dv">1</span>))</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.num_en_cola <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> procesar_salida(<span class="va">self</span>):</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.total_atendidos <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.num_en_cola <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.num_en_cola <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>            t_salida <span class="op">=</span> <span class="va">self</span>.reloj <span class="op">+</span> random.expovariate(</span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.tasa_servicio</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>            heapq.heappush(<span class="va">self</span>.lef, (t_salida, <span class="dv">1</span>))</span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.servidores_ocupados <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reporte_final(<span class="va">self</span>):</span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">40</span>)</span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"      RESULTADOS DE LA SIMULACIÓN"</span>)</span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">40</span>)</span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Tiempo simulado: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>reloj<span class="sc">:.2f}</span><span class="ss"> horas"</span>)</span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Total llegadas:  </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>total_llegadas<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Total atendidos: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>total_atendidos<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Cálculos de promedios</span></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a>        lq <span class="op">=</span> <span class="va">self</span>.area_cola <span class="op">/</span> <span class="va">self</span>.reloj</span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a>        prom_ocupados <span class="op">=</span> <span class="va">self</span>.area_ocupados <span class="op">/</span> <span class="va">self</span>.reloj</span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a>        utilizacion <span class="op">=</span> prom_ocupados <span class="op">/</span> <span class="va">self</span>.n_servidores</span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Wq usando fórmula de Little</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a>        lambda_real <span class="op">=</span> <span class="va">self</span>.total_llegadas <span class="op">/</span> <span class="va">self</span>.reloj</span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a>        wq <span class="op">=</span> lq <span class="op">/</span> lambda_real <span class="cf">if</span> lambda_real <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Longitud prom cola (Lq): </span><span class="sc">{</span>lq<span class="sc">:.4f}</span><span class="ss"> clientes"</span>)</span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Tiempo prom cola (Wq): </span><span class="sc">{</span>wq<span class="op">*</span><span class="dv">60</span><span class="sc">:.2f}</span><span class="ss"> minutos"</span>)</span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Servidores ocupados (prom): </span><span class="sc">{</span>prom_ocupados<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Utilización (Rho): </span><span class="sc">{</span>utilizacion<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">40</span> <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> graficar_historial(<span class="va">self</span>):</span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Gráficos estáticos de evolución de cola y servidores."""</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Desempaquetar datos</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a>        tiempos <span class="op">=</span> [d[<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> <span class="va">self</span>.historia]</span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a>        n_cola <span class="op">=</span> [d[<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> <span class="va">self</span>.historia]</span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a>        n_ocupados <span class="op">=</span> [d[<span class="dv">2</span>] <span class="cf">for</span> d <span class="kw">in</span> <span class="va">self</span>.historia]</span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Configurar figura (2 subplots)</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a>        fig, (ax1, ax2) <span class="op">=</span> plt.subplots(</span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a>            <span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>), sharex<span class="op">=</span><span class="va">True</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Gráfico 1: Evolución de la Cola ---</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a>        ax1.step(tiempos, n_cola, where<span class="op">=</span><span class="st">'post'</span>,</span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'tab:blue'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a>        ax1.fill_between(tiempos, n_cola, step<span class="op">=</span><span class="st">'post'</span>,</span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a>                         alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'tab:blue'</span>)</span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a>        ax1.set_ylabel(<span class="st">'Clientes en Cola'</span>)</span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a>        ax1.set_title(</span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'Evolución Cola (M/M/</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>n_servidores<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a>        ax1.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Gráfico 2: Uso de Servidores ---</span></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a>        ax2.step(tiempos, n_ocupados, where<span class="op">=</span><span class="st">'post'</span>,</span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'tab:orange'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a>        ax2.fill_between(tiempos, n_ocupados, step<span class="op">=</span><span class="st">'post'</span>,</span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a>                         alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'tab:orange'</span>)</span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a>        ax2.set_ylabel(<span class="st">'Servidores Ocupados'</span>)</span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a>        ax2.set_xlabel(<span class="st">'Tiempo de Simulación (horas)'</span>)</span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'Ocupación de Servidores'</span>)</span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Línea de capacidad máxima</span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a>        ax2.axhline(y<span class="op">=</span><span class="va">self</span>.n_servidores, color<span class="op">=</span><span class="st">'red'</span>,</span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a>                    linestyle<span class="op">=</span><span class="st">':'</span>, label<span class="op">=</span><span class="st">'Capacidad Max'</span>)</span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a>        ax2.set_ylim(<span class="dv">0</span>, <span class="va">self</span>.n_servidores <span class="op">+</span> <span class="fl">0.5</span>)</span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a>        ax2.legend()</span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a>        ax2.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a>        plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A continuación se utiliza la clase de Simulación M/M/c implementada. Si <code>n_servidores=1</code> la cola crece infinitamente, esto ese produce un cuello de botella</p>
<div id="0ba65eaf" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.030941,&quot;end_time&quot;:&quot;2025-12-09T04:13:39.880776&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:39.849835&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configurar la simulación (8 horas, lambda=10, mu=4, c=3)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mi_simulacion <span class="op">=</span> SimulacionMMC_Log(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    tiempo_max<span class="op">=</span><span class="fl">8.0</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    tasa_llegada<span class="op">=</span><span class="fl">10.0</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    tasa_servicio<span class="op">=</span><span class="fl">4.0</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    n_servidores<span class="op">=</span><span class="dv">3</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Correr la simulación matemática</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>mi_simulacion.correr()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Iniciando Simulación M/M/3 por 8.0 horas ---

========================================
      RESULTADOS DE LA SIMULACIÓN
========================================
Tiempo simulado: 8.00 horas
Total llegadas:  76
Total atendidos: 74
----------------------------------------
Longitud prom cola (Lq): 1.1194 clientes
Tiempo prom cola (Wq): 7.07 minutos
Servidores ocupados (prom): 2.28
Utilización (Rho): 75.95%
========================================
</code></pre>
</div>
</div>
<p>Para visualizar los resultados de la simulación de eventos discretos se usan gráficos de paso (step plots) dad que el estado del sistema (número en cola en espera o servidores ocupados) permanece constante entre eventos y va cambiando con cada arribo.</p>
<div id="ca335c7c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.484597,&quot;end_time&quot;:&quot;2025-12-09T04:13:40.431730&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:39.947133&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar el gráfico de pasos</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mi_simulacion.graficar_historial()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="parte-4---modelos-continuos" class="level3">
<h3 class="anchored" data-anchor-id="parte-4---modelos-continuos">Parte 4 - Modelos Continuos</h3>
<p>Para implementar un modelo de simulación de eventos basado en un <strong>Proceso de Poisson No Homogéneo (NHPP)</strong> mediante el <strong>método de Thinning</strong> (o adelgazamiento de Lewis-Shedler), el primer paso consiste en definir una tasa mayorante constante <span class="math inline">\(\lambda^*\)</span>, la cual debe ser igual o superior al valor máximo que alcanza la función de intensidad variable <span class="math inline">\(\lambda(t)\)</span> durante todo el periodo de simulación. El motor de simulación avanza generando una secuencia de tiempos de arribo “candidatos” utilizando esta tasa máxima constante, creando efectivamente un proceso de Poisson homogéneo que “sobremuestrea” la línea de tiempo con más eventos de los necesarios.</p>
<p>El segundo paso es el proceso de filtrado estocástico que da nombre al método. Para cada evento candidato generado en el instante <span class="math inline">\(t\)</span>, se evalúa si se conserva o se descarta mediante una prueba de aceptación-rechazo: se genera un número aleatorio uniforme <span class="math inline">\(u \in [0, 1]\)</span> y se compara con el ratio <span class="math inline">\(\lambda(t) / \lambda^*\)</span>. Si <span class="math inline">\(u\)</span> es menor o igual a esta proporción, el evento se acepta y se procesa; de lo contrario, se ignora (se “adelgaza” la secuencia). De esta forma, la probabilidad de aceptar un evento es proporcional a la intensidad real en ese momento, resultando en una distribución de eventos que se ajusta fielmente a la curva de la tasa variable <span class="math inline">\(\lambda(t)\)</span>.</p>
<section id="implementación-de-nhppp-por-thinning" class="level4">
<h4 class="anchored" data-anchor-id="implementación-de-nhppp-por-thinning">Implementación de NHPPP por Thinning</h4>
<p>Así para esta simulación se diseña una función de intensidad <span class="math inline">\(\lambda(t)\)</span> que es realista para una simulación de 7 días: simula ciclos diarios (como el tráfico de una web o clientes en una tienda) con picos durante el día y valles durante la noche. El algoritmo de Thinning (o Aceptación-Rechazo) funciona en tres pasos:</p>
<ol type="1">
<li>Dominancia: Se define una tasa constante <span class="math inline">\(\lambda_{max}\)</span> que sea mayor o igual a la tasa real <span class="math inline">\(\lambda(t)\)</span> en todo momento.</li>
<li>Generación: Se generan “candidatos” a eventos usando un Proceso de Poisson Homogéneo con la tasa máxima <span class="math inline">\(\lambda_{max}\)</span>.</li>
<li>Filtrado (Thinning): Se acepta cada candidato como un evento real con probabilidad <span class="math inline">\(P = \frac{\lambda(t)}{\lambda_{max}}\)</span>.</li>
</ol>
<div id="c55c820f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.037885,&quot;end_time&quot;:&quot;2025-12-09T04:13:40.588639&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:40.550754&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Función de Intensidad</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intensity_function(t):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Define la tasa de llegada lambda(t).</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Ciclo diario (24h) con picos al mediodía.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    cycle <span class="op">=</span> <span class="dv">15</span> <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> (t <span class="op">-</span> <span class="dv">9</span>) <span class="op">/</span> <span class="dv">24</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    rate <span class="op">=</span> <span class="dv">20</span> <span class="op">+</span> cycle</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">0</span>, rate)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Función de Filtro</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_nhpp_thinning(t_max, lambda_upper_bound):</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulación NHPP mediante Thinning.</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna: (lista de eventos, número total de intentos)</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    events <span class="op">=</span> []</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    candidates_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> t <span class="op">&lt;</span> t_max:</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Generar candidato (Poisson Homogéneo)</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        u1 <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> <span class="op">-</span>np.log(u1) <span class="op">/</span> lambda_upper_bound</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> t <span class="op">+</span> w</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> t <span class="op">&gt;=</span> t_max:</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        candidates_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Probabilidad de aceptación</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        prob_acceptance <span class="op">=</span> intensity_function(t) <span class="op">/</span> lambda_upper_bound</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Test de aceptación (Thinning)</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        u2 <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> u2 <span class="op">&lt;=</span> prob_acceptance:</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>            events.append(t)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(events), candidates_count</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Generación de reporte de la simulación</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generar_reporte_texto(events, total_candidates, t_max, dias):</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="co">    Imprime un resumen estadístico de la simulación en la consola.</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    num_events <span class="op">=</span> <span class="bu">len</span>(events)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular tiempos entre llegadas (Inter-arrival times)</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    iat <span class="op">=</span> np.diff(events)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pre-cálculos para acortar las líneas de print</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    eficiencia <span class="op">=</span> num_events <span class="op">/</span> total_candidates</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    prom_global <span class="op">=</span> num_events <span class="op">/</span> t_max</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f" REPORTE DE SIMULACIÓN DE EVENTOS (NHPP) - </span><span class="sc">{</span>dias<span class="sc">}</span><span class="ss"> DÍAS"</span>)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- MÉTRICAS GENERALES ---"</span>)</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tiempo total simulado : </span><span class="sc">{</span>t_max<span class="sc">}</span><span class="ss"> horas"</span>)</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Eventos generados     : </span><span class="sc">{</span>num_events<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Candidatos totales    : </span><span class="sc">{</span>total_candidates<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Eficiencia del Thinning: </span><span class="sc">{</span>eficiencia<span class="sc">:.2%}</span><span class="ss"> "</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(Eventos aceptados / Candidatos)"</span>)</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Promedio global        : </span><span class="sc">{</span>prom_global<span class="sc">:.2f}</span><span class="ss"> eventos/hora"</span>)</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(iat) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>        mean_iat <span class="op">=</span> np.mean(iat)</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- ESTADÍSTICAS DE TIEMPOS ENTRE LLEGADAS (IAT) ---"</span>)</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"IAT Promedio          : </span><span class="sc">{</span>mean_iat<span class="sc">:.4f}</span><span class="ss"> horas "</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"(</span><span class="sc">{</span>mean_iat <span class="op">*</span> <span class="dv">60</span><span class="sc">:.2f}</span><span class="ss"> minutos)"</span>)</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"IAT Mínimo            : </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">min</span>(iat)<span class="sc">:.6f}</span><span class="ss"> horas"</span>)</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"IAT Máximo            : </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(iat)<span class="sc">:.4f}</span><span class="ss"> horas"</span>)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Desviación Estándar   : </span><span class="sc">{</span>np<span class="sc">.</span>std(iat)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- DESGLOSE DIARIO ---"</span>)</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dividimos el encabezado de la tabla para legibilidad</span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="st">'Día'</span><span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Rango Horario'</span><span class="sc">:&lt;20}</span><span class="ss"> | "</span> <span class="op">\</span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>             <span class="ss">f"</span><span class="sc">{</span><span class="st">'Eventos'</span><span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span><span class="st">'Promedio (ev/h)'</span><span class="sc">:&lt;15}</span><span class="ss">"</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(header)</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">65</span>)</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(dias):</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>        start_t <span class="op">=</span> d <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>        end_t <span class="op">=</span> (d <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filtrar eventos que caen en este día (ruptura de línea lógica)</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>        day_events <span class="op">=</span> events[</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>            (events <span class="op">&gt;=</span> start_t) <span class="op">&amp;</span> (events <span class="op">&lt;</span> end_t)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">len</span>(day_events)</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>        avg <span class="op">=</span> count <span class="op">/</span> <span class="dv">24</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Día </span><span class="sc">{</span>d<span class="op">+</span><span class="dv">1</span><span class="sc">:&lt;6}</span><span class="ss"> | </span><span class="sc">{</span>start_t<span class="sc">:03d}</span><span class="ss">h - </span><span class="sc">{</span>end_t<span class="sc">:03d}</span><span class="ss">h         | "</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"</span><span class="sc">{</span>count<span class="sc">:&lt;10}</span><span class="ss"> | </span><span class="sc">{</span>avg<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A continuación estas funciones se usan en una simulación de 7 días o 168 horas:</p>
<div id="432fdf43" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.087159,&quot;end_time&quot;:&quot;2025-12-09T04:13:40.748207&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:40.661048&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>DIAS <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>HORAS_TOTALES <span class="op">=</span> DIAS <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>LAMBDA_MAX <span class="op">=</span> <span class="dv">35</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejecución</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>events, candidates <span class="op">=</span> simulate_nhpp_thinning(HORAS_TOTALES, LAMBDA_MAX)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar Reporte de Texto </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>generar_reporte_texto(events, candidates, HORAS_TOTALES, DIAS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
 REPORTE DE SIMULACIÓN DE EVENTOS (NHPP) - 7 DÍAS
============================================================

--- MÉTRICAS GENERALES ---
Tiempo total simulado : 168 horas
Eventos generados     : 3294
Candidatos totales    : 5776
Eficiencia del Thinning: 57.03% (Eventos aceptados / Candidatos)
Promedio global        : 19.61 eventos/hora

--- ESTADÍSTICAS DE TIEMPOS ENTRE LLEGADAS (IAT) ---
IAT Promedio          : 0.0510 horas (3.06 minutos)
IAT Mínimo            : 0.000020 horas
IAT Máximo            : 1.1459 horas
Desviación Estándar   : 0.0724

--- DESGLOSE DIARIO ---
Día        | Rango Horario        | Eventos    | Promedio (ev/h)
-----------------------------------------------------------------
Día 1      | 000h - 024h         | 487        | 20.29
Día 2      | 024h - 048h         | 454        | 18.92
Día 3      | 048h - 072h         | 442        | 18.42
Día 4      | 072h - 096h         | 479        | 19.96
Día 5      | 096h - 120h         | 472        | 19.67
Día 6      | 120h - 144h         | 469        | 19.54
Día 7      | 144h - 168h         | 491        | 20.46
============================================================</code></pre>
</div>
</div>
<p>Se visualizan los resultados de la simulación:</p>
<div id="39872e9b" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.645424,&quot;end_time&quot;:&quot;2025-12-09T04:13:41.464224&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:40.818800&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>t_values <span class="op">=</span> np.linspace(<span class="dv">0</span>, HORAS_TOTALES, <span class="dv">500</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>lambda_values <span class="op">=</span> [intensity_function(t) <span class="cf">for</span> t <span class="kw">in</span> t_values]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de la tasa lambda (curva continua)</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    t_values, lambda_values, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'navy'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="vs">r'Tasa </span><span class="dv">$</span><span class="er">\</span><span class="vs">lambda</span><span class="kw">(</span><span class="vs">t</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Línea horizontal de Lambda Máximo</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>plt.hlines(</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    LAMBDA_MAX, <span class="dv">0</span>, HORAS_TOTALES, </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span><span class="st">'red'</span>, linestyles<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="vs">r'</span><span class="dv">$</span><span class="er">\</span><span class="vs">lambda_{max}</span><span class="dv">$</span><span class="vs">'</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Líneas verticales para cada evento aceptado</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>plt.vlines(</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>events, ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span><span class="st">'limegreen'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>, linewidth<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Eventos Aceptados'</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Simulación NHPP (7 Días) - </span><span class="sc">{</span><span class="bu">len</span>(events)<span class="sc">}</span><span class="ss"> Eventos Totales'</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Tiempo (Horas)'</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Intensidad / Eventos'</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, HORAS_TOTALES)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración de los ticks del eje X</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>dias_ticks <span class="op">=</span> np.arange(<span class="dv">0</span>, HORAS_TOTALES <span class="op">+</span> <span class="dv">1</span>, <span class="dv">24</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>etiquetas_dias <span class="op">=</span> [<span class="ss">f'Día </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dias_ticks))]</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>plt.xticks(dias_ticks, etiquetas_dias)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La visulización ilustra la evolución temporal de un Proceso de Poisson No Homogéneo (NHPP) durante un periodo de 168 horas, equivalente a siete días completos. El componente principal es la curva azul oscuro que representa la función de intensidad <span class="math inline">\(\lambda(t)\)</span>, la cual exhibe un comportamiento perfectamente cíclico y sinusoidal, oscilando entre una tasa base cercana a 5 y un pico máximo de 35 eventos por hora. Sobre esta curva se proyecta una línea roja discontinua que marca la cota superior <span class="math inline">\(\lambda_{max}\)</span> (establecida en 35), la cual actúa como el techo de referencia necesario para la generación de eventos candidatos dentro del algoritmo de <em>Thinning</em>.</p>
<p>En la franja inferior, las líneas verticales verdes denotan los instantes exactos de los eventos finalmente aceptados por el modelo. Se observa una correlación directa entre la densidad de estas líneas y la magnitud de la función de intensidad: la concentración de eventos se vuelve densa y compacta coincidiendo con los picos de la onda sinusoidal, mientras que se dispersa notablemente durante los valles. Esta distribución visual confirma la eficacia del método de aceptación-rechazo, demostrando que la frecuencia de ocurrencia de los eventos se modula dinámicamente en función de la tasa variable <span class="math inline">\(\lambda(t)\)</span> en cada instante del tiempo.</p>
</section>
</section>
<section id="parte-5---gillespie-ssa-o-next-reaction-method" class="level3">
<h3 class="anchored" data-anchor-id="parte-5---gillespie-ssa-o-next-reaction-method">Parte 5 - Gillespie SSA o Next Reaction Method</h3>
<p>Para implementar el <strong>algoritmo de Gillespie (SSA) en este sistema</strong>, primero se deben calcular en cada iteración las propensiones (<span class="math inline">\(a_v\)</span>) que determinan la probabilidad instantánea de cada canal de reacción. Para la síntesis (orden cero), la propensión es constante, <span class="math inline">\(a_1 = k_1 = 10\)</span>; para la degradación (primer orden), la propensión depende del estado actual de la población, <span class="math inline">\(a_2 = k_2 \times [\text{mRNA}]\)</span>. Se calcula la propensión total <span class="math inline">\(a_0 = a_1 + a_2\)</span> y se genera el tiempo hasta el próximo evento (<span class="math inline">\(\tau\)</span>) muestreando una distribución exponencial con media <span class="math inline">\(1/a_0\)</span> (usualmente <span class="math inline">\(-\ln(u_1)/a_0\)</span>), lo que define cuánto tiempo transcurre en el sistema antes de que la configuración molecular cambie.</p>
<p>Una vez determinado el “cuándo”, se decide el “qué” seleccionando una de las dos reacciones con probabilidad proporcional a su magnitud relativa (<span class="math inline">\(P_{síntesis} = a_1/a_0\)</span> y <span class="math inline">\(P_{degradación} = a_2/a_0\)</span>). Dependiendo de la reacción elegida, se actualiza el contador de moléculas de mRNA incrementándolo o decrementándolo en una unidad, se avanza el tiempo de simulación (<span class="math inline">\(t \leftarrow t + \tau\)</span>) y, crucialmente, se recalculan las propensiones para el siguiente paso, dado que <span class="math inline">\(a_2\)</span> cambiará cada vez que varíe la cantidad de mRNA, capturando así las fluctuaciones estocásticas intrínsecas del sistema.</p>
<section id="algoritmo-de-gillespie-método-directo" class="level4">
<h4 class="anchored" data-anchor-id="algoritmo-de-gillespie-método-directo">Algoritmo de Gillespie (Método Directo)</h4>
<p>Esta es una implementación del Algoritmo de Gillespie (Método Directo) en Python para el sistema de nacimiento y muerte (producción y degradación de ARNm) planteado:</p>
<p><span class="math display">\[\to \text{mRNA} (k_{1}=10)\]</span> <span class="math display">\[\text{mRNA}\to (k_{2}=1)\]</span></p>
<p>Basado en esta descripción tenemos dos reacciones: 1. Producción (Transcripción): <span class="math inline">\(\emptyset \xrightarrow{k_1} \text{mRNA}\)</span>. Tasa constante: <span class="math inline">\(k_1 = 10\)</span>. Esta reacción incrementa el conteo de ARNm en 1. 3. Degradación: <span class="math inline">\(\text{mRNA} \xrightarrow{k_2} \emptyset\)</span>. Tasa dependiente de la cantidad actual: <span class="math inline">\(k_2 = 1\)</span>. Esta reacción disminuye el conteo de ARNm en 1.</p>
<p>Cabe destacar que el estado estacionario promedio esperado es <span class="math inline">\(k_1 / k_2 = 10\)</span> moléculas. El estado estacionario promedio de <span class="math inline">\(10\)</span> moléculas se fundamenta en el principio de equilibrio dinámico, el cual se alcanza cuando la velocidad de entrada (producción) iguala a la velocidad de salida (degradación) del sistema. Dado que la producción ocurre a una tasa constante <span class="math inline">\(k_1\)</span> y la degradación es proporcional a la cantidad de moléculas presentes (<span class="math inline">\(k_2 \cdot \text{mRNA}\)</span>), el balance se logra matemáticamente cuando <span class="math inline">\(k_1 = k_2 \cdot \text{mRNA}\)</span>; al despejar la concentración de equilibrio, se obtiene el cociente <span class="math inline">\(k_1 / k_2\)</span>, lo que resulta en un valor promedio de <span class="math inline">\(10\)</span> moléculas para los parámetros dados.</p>
<div id="29c5a5b2" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.042372,&quot;end_time&quot;:&quot;2025-12-09T04:13:41.688390&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:41.646018&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Funcion de Simulacion</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gillespie_ssa(k1, k2, t_max):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inicialización</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Condición inicial (puedes cambiarla)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    mRNA <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Listas para guardar el historial (para graficar)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    time_points <span class="op">=</span> [t]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    mRNA_counts <span class="op">=</span> [mRNA]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> t <span class="op">&lt;</span> t_max:</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Calcular las propensiones (propensities)</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a1: Probabilidad de producción (constante)</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> k1</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a2: Prob. degradación (proporcional a moléculas)</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        a2 <span class="op">=</span> k2 <span class="op">*</span> mRNA</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        a_sum <span class="op">=</span> a1 <span class="op">+</span> a2</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si a_sum es 0, el sistema para (sin reacciones)</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a_sum <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Determinar tiempo hasta próxima reacción (tau)</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se extrae de una distribución exponencial</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        r1 <span class="op">=</span> np.random.rand()</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        tau <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">/</span> a_sum) <span class="op">*</span> np.log(<span class="fl">1.0</span> <span class="op">/</span> r1)</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Determinar qué reacción ocurre</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        r2 <span class="op">=</span> np.random.rand()</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r2 <span class="op">&lt;</span> (a1 <span class="op">/</span> a_sum):</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Ocurre Reacción 1: Producción</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>            mRNA <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Ocurre Reacción 2: Degradación</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>            mRNA <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Actualizar tiempo y guardar estado</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>        t <span class="op">+=</span> tau</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>        time_points.append(t)</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>        mRNA_counts.append(mRNA)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> time_points, mRNA_counts</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para Generar el Informe</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generar_informe_texto(tiempos, conteos, k1, k2):</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir a numpy array para cálculos estadísticos</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    arr_conteos <span class="op">=</span> np.array(conteos)</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cálculos estadísticos sobre la simulación</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    media_sim <span class="op">=</span> np.mean(arr_conteos)</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    desv_std <span class="op">=</span> np.std(arr_conteos)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    var_sim <span class="op">=</span> np.var(arr_conteos)</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    min_val <span class="op">=</span> np.<span class="bu">min</span>(arr_conteos)</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    max_val <span class="op">=</span> np.<span class="bu">max</span>(arr_conteos)</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>    total_ev <span class="op">=</span> <span class="bu">len</span>(tiempos) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>    t_final <span class="op">=</span> tiempos[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Valores Teóricos</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>    media_teorica <span class="op">=</span> k1 <span class="op">/</span> k2</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># En Poisson ideal, varianza es igual a la media</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>    var_teorica <span class="op">=</span> media_teorica </span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cálculo del error relativo (dividido en pasos)</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>    diff <span class="op">=</span> <span class="bu">abs</span>(media_sim <span class="op">-</span> media_teorica)</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>    error_rel <span class="op">=</span> (diff <span class="op">/</span> media_teorica) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Definimos separadores para usar dentro del f-string</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>    sep <span class="op">=</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construcción del reporte usando concatenación implícita</span></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># para respetar el ancho de 70 caracteres en el editor</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>    informe <span class="op">=</span> (</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>sep<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"SIMULACIÓN ESTOCÁSTICA (GILLESPIE SSA)</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>sep<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"1. PARÁMETROS DEL SISTEMA</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>sub<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Reacción 1 (Producción) k1 : </span><span class="sc">{</span>k1<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Reacción 2 (Degradación) k2: </span><span class="sc">{</span>k2<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Tiempo total simulado      : </span><span class="sc">{</span>t_final<span class="sc">:.2f}</span><span class="ss"> u.t.</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Total de eventos ocurridos : </span><span class="sc">{</span>total_ev<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"2. ANÁLISIS ESTADÍSTICO DE LA TRAYECTORIA</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>sub<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Media observada            : </span><span class="sc">{</span>media_sim<span class="sc">:.4f}</span><span class="ss"> mols</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Desviación estándar        : </span><span class="sc">{</span>desv_std<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Varianza observada         : </span><span class="sc">{</span>var_sim<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Rango de fluctuación       : [</span><span class="sc">{</span>min_val<span class="sc">}</span><span class="ss">] - [</span><span class="sc">{</span>max_val<span class="sc">}</span><span class="ss">]</span><span class="ch">\n\n</span><span class="ss">"</span></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"3. VALIDACIÓN CON MODELO TEÓRICO</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>sub<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Estado Estacionario Esp.   : </span><span class="sc">{</span>media_teorica<span class="sc">:.4f}</span><span class="ss"> mols</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Varianza Esperada (Poisson): </span><span class="sc">{</span>var_teorica<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Error Relativo (Media)     : </span><span class="sc">{</span>error_rel<span class="sc">:.2f}</span><span class="ss">%</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> informe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>A continuación se usa la simulación para el sistema planteado:</p>
<div id="ce397810" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.092561,&quot;end_time&quot;:&quot;2025-12-09T04:13:41.867912&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:41.775351&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dado que se simulan ARNm, los procesos de transcripción y </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># degradación suelen medirse en minutos o horas.</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>k1 <span class="op">=</span> <span class="fl">10.0</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>k2 <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>t_max <span class="op">=</span> <span class="fl">1000.0</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Simular</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>tiempos, conteos <span class="op">=</span> gillespie_ssa(k1, k2, t_max)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generar e imprimir informe</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>reporte <span class="op">=</span> generar_informe_texto(tiempos, conteos, k1, k2)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(reporte)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================================
SIMULACIÓN ESTOCÁSTICA (GILLESPIE SSA)
==================================================

1. PARÁMETROS DEL SISTEMA
--------------------------------------------------
Reacción 1 (Producción) k1 : 10.0
Reacción 2 (Degradación) k2: 1.0
Tiempo total simulado      : 1000.00 u.t.
Total de eventos ocurridos : 20185

2. ANÁLISIS ESTADÍSTICO DE LA TRAYECTORIA
--------------------------------------------------
Media observada            : 10.7573 mols
Desviación estándar        : 3.3082
Varianza observada         : 10.9444
Rango de fluctuación       : [0] - [24]

3. VALIDACIÓN CON MODELO TEÓRICO
--------------------------------------------------
Estado Estacionario Esp.   : 10.0000 mols
Varianza Esperada (Poisson): 10.0000
Error Relativo (Media)     : 7.57%
</code></pre>
</div>
</div>
<p>Se visualizan los resultados de la simulación:</p>
<div id="181742ce" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.339593,&quot;end_time&quot;:&quot;2025-12-09T04:13:42.288055&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:41.948462&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar trayectoria (step plot para saltos discretos)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.step(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    tiempos,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    conteos,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    where<span class="op">=</span><span class="st">'post'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Trayectoria Estocástica (Gillespie)'</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar la media teórica (k1 / k2)</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>media_teorica <span class="op">=</span> k1 <span class="op">/</span> k2</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>plt.axhline(</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>media_teorica,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'r'</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Usamos .2f para evitar que el número sea muy largo</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f'Media Teórica (</span><span class="sc">{</span>media_teorica<span class="sc">:.2f}</span><span class="ss">)'</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Simulación Gillespie: Producción y Degradación de ARNm'</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Tiempo'</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Número de moléculas de ARNm'</span>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La visualización ilustra la naturaleza estocástica del sistema de producción y degradación de ARNm, donde la trayectoria azul exhibe fluctuaciones continuas y aleatorias inherentes al ruido intrínseco del proceso biológico. Se observa que, tras superar la condición inicial nula, el número de moléculas oscila dinámicamente alrededor del valor de equilibrio teórico señalado por la línea discontinua roja (10 moléculas), demostrando que, si bien el promedio temporal del sistema converge al modelo determinista, el estado instantáneo varía constantemente dentro de un rango de dispersión característico (aproximadamente entre 0 y 23 moléculas).</p>
</section>
</section>
<section id="parte-integradora---simulación-de-tráfico-aéreo" class="level3">
<h3 class="anchored" data-anchor-id="parte-integradora---simulación-de-tráfico-aéreo">Parte Integradora - Simulación de Tráfico Aéreo</h3>
<p>Se propone un modelo de simulación híbrida de tráfico aéreo donde el flujo de entrada de aeronaves se gestiona mediante un Proceso de Poisson No Homogéneo (NHPP) utilizando el método de Thinning. Este componente permite modelar fielmente las curvas de demanda operativa del aeropuerto, generando llegadas estocásticas que respetan los picos horarios (horas punta) y los valles nocturnos. Estas entidades (aviones) ingresan a un sistema de colas modelado bajo la lógica M/M/1, donde la pista de aterrizaje actúa como el servidor único con tiempos de servicio exponenciales, gestionando tanto la cola de espera en el aire (holding pattern) como en tierra (taxiway).</p>
<p>De forma paralela y asíncrona, se ejecuta un motor basado en el Algoritmo de Gillespie (SSA) para simular la dinámica meteorológica. En este contexto, los estados del clima (ej. “Despejado”, “Viento Cruzado”, “Tormenta Eléctrica”) se tratan como “especies químicas” discretas que transicionan estocásticamente en función de tasas de cambio históricas (propensidades). El algoritmo de Gillespie determina los intervalos exactos de tiempo en los que el sistema permanece en cada estado climático, generando una línea de tiempo de condiciones ambientales independiente del tráfico aéreo pero estadísticamente exacta.</p>
<p>La integración de ambos modelos se realiza mediante una modulación dinámica de la tasa de servicio (<span class="math inline">\(\mu\)</span>). El estado vigente dictado por el módulo Gillespie actúa como una variable de control sobre el modelo M/M/1: cuando Gillespie transiciona a un estado de “Tormenta”, la tasa de servicio de la pista se reduce drásticamente o se anula (<span class="math inline">\(\mu \to 0\)</span>), provocando que las operaciones de aterrizaje y despegue se aborten. Esto fuerza al sistema de colas a entrar en un régimen de saturación o desvío de entidades, permitiendo analizar no solo la congestión por volumen de tráfico, sino la resiliencia del aeropuerto ante ventanas de inoperatividad estocástica y su capacidad de recuperación (recovery rate) una vez restablecidas las condiciones favorables.</p>
<p>El pipeline de ejecución se orquesta mediante un reloj maestro que sincroniza dos generadores de eventos concurrentes: un módulo de tráfico que inyecta entidades (aeronaves) en la línea de tiempo usando NHPP por Thinning para replicar la demanda horaria, y un motor Gillespie independiente que actualiza asincrónicamente el estado global del clima (variables de entorno). Dentro del bucle principal de procesamiento (LEF), la lógica del servidor M/M/1 consulta en tiempo real el estado vigente dictado por Gillespie antes de intentar atender a una aeronave; si el motor climático indica un evento adverso (ej. “Tormenta”), se activa una interrupción que anula o penaliza drásticamente la tasa de servicio (<span class="math inline">\(\mu\)</span>), forzando la acumulación de entidades en la cola hasta que una nueva transición estocástica del clima restablezca la operatividad, permitiendo así medir el impacto sistémico de la interrupción.</p>
<div id="cc0513bf" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.365121,&quot;end_time&quot;:&quot;2025-12-09T04:13:42.808829&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:42.443708&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> heapq</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. CONFIGURACIÓN Y PARÁMETROS</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>SIM_DURATION <span class="op">=</span> <span class="fl">24.0</span>  <span class="co"># Horas</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>SEED <span class="op">=</span> rnd_seed</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros de Tráfico (NHPP)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>LAMBDA_MAX <span class="op">=</span> <span class="fl">20.0</span>    <span class="co"># Tasa máxima de llegadas (aviones/hora) para Thinning</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>MU_OPERATIVO <span class="op">=</span> <span class="fl">25.0</span>  <span class="co"># Tasa de servicio de la pista (aviones/hora) en buen clima</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros Climáticos (Gillespie)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Estado 0: Despejado, Estado 1: Tormenta</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>TASA_DESPEJADO_A_TORMENTA <span class="op">=</span> <span class="fl">0.15</span>  <span class="co"># Frecuencia de aparición de tormentas</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>TASA_TORMENTA_A_DESPEJADO <span class="op">=</span> <span class="fl">0.8</span>   <span class="co"># Velocidad de recuperación (duración tormenta)</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Tipos de Eventos</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>EVT_ARRIVAL <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>EVT_DEPARTURE <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>EVT_WEATHER <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Estados del Clima</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>CLIMA_CLEAR <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>CLIMA_STORM <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>np.random.seed(SEED)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>random.seed(SEED)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HybridAirportSim:</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, t_max):</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t_max <span class="op">=</span> t_max</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.clock <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estado del Sistema</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.queue_count <span class="op">=</span> <span class="dv">0</span>        <span class="co"># Aviones en cola (aire + tierra)</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.server_busy <span class="op">=</span> <span class="va">False</span>    <span class="co"># Estado de la pista</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.weather_state <span class="op">=</span> CLIMA_CLEAR</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Gestión de Eventos (Lista de Eventos Futuros - LEF)</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.events <span class="op">=</span> []  <span class="co"># Heapq</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Control de Eventos de Salida (para poder cancelarlos)</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.current_departure_token <span class="op">=</span> <span class="va">None</span> </span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estadísticas</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stats <span class="op">=</span> {</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'arrivals'</span>: <span class="dv">0</span>,</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'completed'</span>: <span class="dv">0</span>,</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'aborted_ops'</span>: <span class="dv">0</span>,  <span class="co"># Operaciones canceladas por clima</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weather_changes'</span>: <span class="dv">0</span>,</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">'storm_duration'</span>: <span class="fl">0.0</span></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Historiales para graficar (tiempo, valor)</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history_occupancy <span class="op">=</span> [(<span class="fl">0.0</span>, <span class="dv">0</span>)]</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history_weather <span class="op">=</span> [(<span class="fl">0.0</span>, CLIMA_CLEAR)]</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history_aborts <span class="op">=</span> [] <span class="co"># Puntos (t, y) donde hubo abortos</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> schedule_event(<span class="va">self</span>, time, event_type, token<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> time <span class="op">&lt;=</span> <span class="va">self</span>.t_max:</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>            heapq.heappush(<span class="va">self</span>.events, (time, event_type, token))</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MÓDULO 1: TRÁFICO AÉREO (NHPP - Thinning Algorithm)</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_arrival_rate(<span class="va">self</span>, t):</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Función de intensidad lambda(t).</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="co">        Modela picos de tráfico a las 8am y 6pm.</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Base de 5 aviones + oscilación de hasta 10 aviones</span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># t está en horas (0-24)</span></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a>        cycle <span class="op">=</span> np.sin((t <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> np.pi <span class="op">/</span> <span class="dv">12</span>) <span class="op">**</span> <span class="dv">2</span>  </span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>        rate <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">15</span> <span class="op">*</span> cycle </span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> rate</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> schedule_next_arrival_nhpp(<span class="va">self</span>):</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Genera la próxima llegada usando Thinning."""</span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>        t_curr <span class="op">=</span> <span class="va">self</span>.clock</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 1. Generar paso de tiempo con tasa homogénea máxima</span></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>            u1 <span class="op">=</span> random.random()</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>            dt <span class="op">=</span> <span class="op">-</span>np.log(u1) <span class="op">/</span> LAMBDA_MAX</span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>            t_curr <span class="op">+=</span> dt</span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> t_curr <span class="op">&gt;</span> <span class="va">self</span>.t_max:</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="co"># Fin de simulación</span></span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 2. Test de aceptación/rechazo (Thinning)</span></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a>            lambda_t <span class="op">=</span> <span class="va">self</span>.get_arrival_rate(t_curr)</span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a>            prob_accept <span class="op">=</span> lambda_t <span class="op">/</span> LAMBDA_MAX</span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> random.random() <span class="op">&lt;=</span> prob_accept:</span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.schedule_event(t_curr, EVT_ARRIVAL)</span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MÓDULO 2: MOTOR CLIMÁTICO (GILLESPIE SSA)</span></span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> schedule_next_weather_change(<span class="va">self</span>):</span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a><span class="co">        Determina el tiempo hasta el próximo cambio de clima</span></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a><span class="co">        basado en propensiones estocásticas (Gillespie).</span></span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determinar propensión (a0) según estado actual</span></span>
<span id="cb29-110"><a href="#cb29-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.weather_state <span class="op">==</span> CLIMA_CLEAR:</span>
<span id="cb29-111"><a href="#cb29-111" aria-hidden="true" tabindex="-1"></a>            a0 <span class="op">=</span> TASA_DESPEJADO_A_TORMENTA</span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-113"><a href="#cb29-113" aria-hidden="true" tabindex="-1"></a>            a0 <span class="op">=</span> TASA_TORMENTA_A_DESPEJADO</span>
<span id="cb29-114"><a href="#cb29-114" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Tiempo hasta la próxima reacción (tau)</span></span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a0 <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a>            r <span class="op">=</span> random.random()</span>
<span id="cb29-118"><a href="#cb29-118" aria-hidden="true" tabindex="-1"></a>            tau <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">/</span> a0) <span class="op">*</span> np.log(<span class="fl">1.0</span> <span class="op">/</span> r)</span>
<span id="cb29-119"><a href="#cb29-119" aria-hidden="true" tabindex="-1"></a>            next_time <span class="op">=</span> <span class="va">self</span>.clock <span class="op">+</span> tau</span>
<span id="cb29-120"><a href="#cb29-120" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.schedule_event(next_time, EVT_WEATHER)</span>
<span id="cb29-121"><a href="#cb29-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-122"><a href="#cb29-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-123"><a href="#cb29-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MÓDULO 3: NÚCLEO DE SIMULACIÓN Y LÓGICA DE CONTROL</span></span>
<span id="cb29-124"><a href="#cb29-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-125"><a href="#cb29-125" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb29-126"><a href="#cb29-126" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Inicialización</span></span>
<span id="cb29-127"><a href="#cb29-127" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule_next_arrival_nhpp()</span>
<span id="cb29-128"><a href="#cb29-128" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule_next_weather_change()</span>
<span id="cb29-129"><a href="#cb29-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-130"><a href="#cb29-130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"--- Iniciando Simulación Híbrida (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>t_max<span class="sc">}</span><span class="ss">h) ---"</span>)</span>
<span id="cb29-131"><a href="#cb29-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-132"><a href="#cb29-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.events:</span>
<span id="cb29-133"><a href="#cb29-133" aria-hidden="true" tabindex="-1"></a>            time, <span class="bu">type</span>, token <span class="op">=</span> heapq.heappop(<span class="va">self</span>.events)</span>
<span id="cb29-134"><a href="#cb29-134" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-135"><a href="#cb29-135" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Avanzar reloj</span></span>
<span id="cb29-136"><a href="#cb29-136" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.clock <span class="op">=</span> time</span>
<span id="cb29-137"><a href="#cb29-137" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-138"><a href="#cb29-138" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Registrar estado para gráficos (Step plot)</span></span>
<span id="cb29-139"><a href="#cb29-139" aria-hidden="true" tabindex="-1"></a>            curr_occupancy <span class="op">=</span> <span class="va">self</span>.queue_count <span class="op">+</span> (<span class="dv">1</span> <span class="cf">if</span> <span class="va">self</span>.server_busy <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb29-140"><a href="#cb29-140" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history_occupancy.append((<span class="va">self</span>.clock, curr_occupancy))</span>
<span id="cb29-141"><a href="#cb29-141" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.history_weather.append((<span class="va">self</span>.clock, <span class="va">self</span>.weather_state))</span>
<span id="cb29-142"><a href="#cb29-142" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-143"><a href="#cb29-143" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Despachador de eventos</span></span>
<span id="cb29-144"><a href="#cb29-144" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">type</span> <span class="op">==</span> EVT_ARRIVAL:</span>
<span id="cb29-145"><a href="#cb29-145" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.handle_arrival()</span>
<span id="cb29-146"><a href="#cb29-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">type</span> <span class="op">==</span> EVT_DEPARTURE:</span>
<span id="cb29-147"><a href="#cb29-147" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.handle_departure(token)</span>
<span id="cb29-148"><a href="#cb29-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">type</span> <span class="op">==</span> EVT_WEATHER:</span>
<span id="cb29-149"><a href="#cb29-149" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.handle_weather_change()</span>
<span id="cb29-150"><a href="#cb29-150" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-151"><a href="#cb29-151" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.generate_report()</span>
<span id="cb29-152"><a href="#cb29-152" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.plot_results()</span>
<span id="cb29-153"><a href="#cb29-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-154"><a href="#cb29-154" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_arrival(<span class="va">self</span>):</span>
<span id="cb29-155"><a href="#cb29-155" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stats[<span class="st">'arrivals'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-156"><a href="#cb29-156" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule_next_arrival_nhpp() <span class="co"># Programar siguiente recursivamente</span></span>
<span id="cb29-157"><a href="#cb29-157" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-158"><a href="#cb29-158" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.server_busy <span class="kw">and</span> <span class="va">self</span>.weather_state <span class="op">==</span> CLIMA_CLEAR:</span>
<span id="cb29-159"><a href="#cb29-159" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pista libre y buen clima: Aterrizaje inmediato</span></span>
<span id="cb29-160"><a href="#cb29-160" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.server_busy <span class="op">=</span> <span class="va">True</span></span>
<span id="cb29-161"><a href="#cb29-161" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.schedule_departure()</span>
<span id="cb29-162"><a href="#cb29-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-163"><a href="#cb29-163" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pista ocupada O clima adverso: A la cola (Holding)</span></span>
<span id="cb29-164"><a href="#cb29-164" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.queue_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-165"><a href="#cb29-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-166"><a href="#cb29-166" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> schedule_departure(<span class="va">self</span>):</span>
<span id="cb29-167"><a href="#cb29-167" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generar tiempo de servicio exponencial</span></span>
<span id="cb29-168"><a href="#cb29-168" aria-hidden="true" tabindex="-1"></a>        service_time <span class="op">=</span> random.expovariate(MU_OPERATIVO)</span>
<span id="cb29-169"><a href="#cb29-169" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-170"><a href="#cb29-170" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Crear un token único para este servicio</span></span>
<span id="cb29-171"><a href="#cb29-171" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Esto permite invalidar el evento si el clima cambia</span></span>
<span id="cb29-172"><a href="#cb29-172" aria-hidden="true" tabindex="-1"></a>        token <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="fl">1e9</span>)</span>
<span id="cb29-173"><a href="#cb29-173" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.current_departure_token <span class="op">=</span> token</span>
<span id="cb29-174"><a href="#cb29-174" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-175"><a href="#cb29-175" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule_event(<span class="va">self</span>.clock <span class="op">+</span> service_time, EVT_DEPARTURE, token)</span>
<span id="cb29-176"><a href="#cb29-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-177"><a href="#cb29-177" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_departure(<span class="va">self</span>, token):</span>
<span id="cb29-178"><a href="#cb29-178" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificar si el token es válido (no fue abortado)</span></span>
<span id="cb29-179"><a href="#cb29-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> token <span class="op">!=</span> <span class="va">self</span>.current_departure_token:</span>
<span id="cb29-180"><a href="#cb29-180" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="co"># Evento ignorado (fue cancelado por clima)</span></span>
<span id="cb29-181"><a href="#cb29-181" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-182"><a href="#cb29-182" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stats[<span class="st">'completed'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-183"><a href="#cb29-183" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.server_busy <span class="op">=</span> <span class="va">False</span></span>
<span id="cb29-184"><a href="#cb29-184" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.current_departure_token <span class="op">=</span> <span class="va">None</span></span>
<span id="cb29-185"><a href="#cb29-185" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-186"><a href="#cb29-186" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Intentar procesar siguiente en cola SI el clima lo permite</span></span>
<span id="cb29-187"><a href="#cb29-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.queue_count <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.weather_state <span class="op">==</span> CLIMA_CLEAR:</span>
<span id="cb29-188"><a href="#cb29-188" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.queue_count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb29-189"><a href="#cb29-189" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.server_busy <span class="op">=</span> <span class="va">True</span></span>
<span id="cb29-190"><a href="#cb29-190" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.schedule_departure()</span>
<span id="cb29-191"><a href="#cb29-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-192"><a href="#cb29-192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handle_weather_change(<span class="va">self</span>):</span>
<span id="cb29-193"><a href="#cb29-193" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stats[<span class="st">'weather_changes'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-194"><a href="#cb29-194" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-195"><a href="#cb29-195" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Alternar estado (0 -&gt; 1, 1 -&gt; 0)</span></span>
<span id="cb29-196"><a href="#cb29-196" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.weather_state <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="va">self</span>.weather_state</span>
<span id="cb29-197"><a href="#cb29-197" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-198"><a href="#cb29-198" aria-hidden="true" tabindex="-1"></a>        <span class="co"># LÓGICA DE INTERRUPCIÓN / RECUPERACIÓN</span></span>
<span id="cb29-199"><a href="#cb29-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.weather_state <span class="op">==</span> CLIMA_STORM:</span>
<span id="cb29-200"><a href="#cb29-200" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Transición a TORMENTA</span></span>
<span id="cb29-201"><a href="#cb29-201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.server_busy:</span>
<span id="cb29-202"><a href="#cb29-202" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ABORTAR OPERACIÓN</span></span>
<span id="cb29-203"><a href="#cb29-203" aria-hidden="true" tabindex="-1"></a>                <span class="co"># La aeronave debe hacer 'go-around' y volver a cola</span></span>
<span id="cb29-204"><a href="#cb29-204" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.stats[<span class="st">'aborted_ops'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-205"><a href="#cb29-205" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.server_busy <span class="op">=</span> <span class="va">False</span></span>
<span id="cb29-206"><a href="#cb29-206" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.queue_count <span class="op">+=</span> <span class="dv">1</span> <span class="co"># Regresa a la cola</span></span>
<span id="cb29-207"><a href="#cb29-207" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-208"><a href="#cb29-208" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Invalida el evento de salida pendiente</span></span>
<span id="cb29-209"><a href="#cb29-209" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.current_departure_token <span class="op">=</span> <span class="va">None</span> </span>
<span id="cb29-210"><a href="#cb29-210" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-211"><a href="#cb29-211" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Guardar punto para gráfico</span></span>
<span id="cb29-212"><a href="#cb29-212" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.history_aborts.append(</span>
<span id="cb29-213"><a href="#cb29-213" aria-hidden="true" tabindex="-1"></a>                    (<span class="va">self</span>.clock, <span class="va">self</span>.queue_count <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb29-214"><a href="#cb29-214" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb29-215"><a href="#cb29-215" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb29-216"><a href="#cb29-216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.weather_state <span class="op">==</span> CLIMA_CLEAR:</span>
<span id="cb29-217"><a href="#cb29-217" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Transición a DESPEJADO (Recuperación)</span></span>
<span id="cb29-218"><a href="#cb29-218" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Si hay cola, reiniciar operaciones inmediatamente</span></span>
<span id="cb29-219"><a href="#cb29-219" aria-hidden="true" tabindex="-1"></a>            can_resume <span class="op">=</span> (<span class="va">self</span>.queue_count <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> </span>
<span id="cb29-220"><a href="#cb29-220" aria-hidden="true" tabindex="-1"></a>                          <span class="kw">not</span> <span class="va">self</span>.server_busy)</span>
<span id="cb29-221"><a href="#cb29-221" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb29-222"><a href="#cb29-222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> can_resume:</span>
<span id="cb29-223"><a href="#cb29-223" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.queue_count <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb29-224"><a href="#cb29-224" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.server_busy <span class="op">=</span> <span class="va">True</span></span>
<span id="cb29-225"><a href="#cb29-225" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.schedule_departure()</span>
<span id="cb29-226"><a href="#cb29-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-227"><a href="#cb29-227" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Programar siguiente cambio de clima (Gillespie)</span></span>
<span id="cb29-228"><a href="#cb29-228" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule_next_weather_change()</span>
<span id="cb29-229"><a href="#cb29-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-230"><a href="#cb29-230" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-231"><a href="#cb29-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GENERACIÓN DE REPORTES Y GRÁFICOS</span></span>
<span id="cb29-232"><a href="#cb29-232" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---------------------------------------------------------</span></span>
<span id="cb29-233"><a href="#cb29-233" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_report(<span class="va">self</span>):</span>
<span id="cb29-234"><a href="#cb29-234" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calcular tiempo total en tormenta</span></span>
<span id="cb29-235"><a href="#cb29-235" aria-hidden="true" tabindex="-1"></a>        t_storm <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-236"><a href="#cb29-236" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Alias para acortar líneas</span></span>
<span id="cb29-237"><a href="#cb29-237" aria-hidden="true" tabindex="-1"></a>        hist <span class="op">=</span> <span class="va">self</span>.history_weather</span>
<span id="cb29-238"><a href="#cb29-238" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-239"><a href="#cb29-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(hist)):</span>
<span id="cb29-240"><a href="#cb29-240" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Desglose de cálculo de tiempo</span></span>
<span id="cb29-241"><a href="#cb29-241" aria-hidden="true" tabindex="-1"></a>            t_curr <span class="op">=</span> hist[i][<span class="dv">0</span>]</span>
<span id="cb29-242"><a href="#cb29-242" aria-hidden="true" tabindex="-1"></a>            t_prev <span class="op">=</span> hist[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb29-243"><a href="#cb29-243" aria-hidden="true" tabindex="-1"></a>            t_delta <span class="op">=</span> t_curr <span class="op">-</span> t_prev</span>
<span id="cb29-244"><a href="#cb29-244" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-245"><a href="#cb29-245" aria-hidden="true" tabindex="-1"></a>            state <span class="op">=</span> hist[i<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb29-246"><a href="#cb29-246" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> state <span class="op">==</span> CLIMA_STORM:</span>
<span id="cb29-247"><a href="#cb29-247" aria-hidden="true" tabindex="-1"></a>                t_storm <span class="op">+=</span> t_delta</span>
<span id="cb29-248"><a href="#cb29-248" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-249"><a href="#cb29-249" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pre-cálculo de porcentaje para limpiar el f-string</span></span>
<span id="cb29-250"><a href="#cb29-250" aria-hidden="true" tabindex="-1"></a>        pct_storm <span class="op">=</span> (t_storm <span class="op">/</span> <span class="va">self</span>.t_max) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb29-251"><a href="#cb29-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-252"><a href="#cb29-252" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb29-253"><a href="#cb29-253" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"REPORTE DE SIMULACIÓN AEROPORTUARIA HÍBRIDA"</span>)</span>
<span id="cb29-254"><a href="#cb29-254" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb29-255"><a href="#cb29-255" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-256"><a href="#cb29-256" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Duración Simulación     : </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>t_max<span class="sc">}</span><span class="ss"> horas"</span>)</span>
<span id="cb29-257"><a href="#cb29-257" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-258"><a href="#cb29-258" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Total Llegadas (NHPP)   : "</span></span>
<span id="cb29-259"><a href="#cb29-259" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>stats[<span class="st">'arrivals'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-260"><a href="#cb29-260" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb29-261"><a href="#cb29-261" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Aterrizajes Exitosos    : "</span></span>
<span id="cb29-262"><a href="#cb29-262" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>stats[<span class="st">'completed'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-263"><a href="#cb29-263" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb29-264"><a href="#cb29-264" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Operaciones Abortadas   : "</span></span>
<span id="cb29-265"><a href="#cb29-265" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>stats[<span class="st">'aborted_ops'</span>]<span class="sc">}</span><span class="ss"> (Go-arounds)"</span>)</span>
<span id="cb29-266"><a href="#cb29-266" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb29-267"><a href="#cb29-267" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb29-268"><a href="#cb29-268" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"METEOROLOGÍA (GILLESPIE SSA)"</span>)</span>
<span id="cb29-269"><a href="#cb29-269" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-270"><a href="#cb29-270" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Eventos de Cambio Clima : "</span></span>
<span id="cb29-271"><a href="#cb29-271" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>stats[<span class="st">'weather_changes'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-272"><a href="#cb29-272" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb29-273"><a href="#cb29-273" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Tiempo en Tormenta      : </span><span class="sc">{</span>t_storm<span class="sc">:.2f}</span><span class="ss"> h "</span></span>
<span id="cb29-274"><a href="#cb29-274" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"(</span><span class="sc">{</span>pct_storm<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb29-275"><a href="#cb29-275" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb29-276"><a href="#cb29-276" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span> <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb29-277"><a href="#cb29-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-278"><a href="#cb29-278" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_results(<span class="va">self</span>):</span>
<span id="cb29-279"><a href="#cb29-279" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Desempaquetar datos para historial de ocupación</span></span>
<span id="cb29-280"><a href="#cb29-280" aria-hidden="true" tabindex="-1"></a>        times <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.history_occupancy]</span>
<span id="cb29-281"><a href="#cb29-281" aria-hidden="true" tabindex="-1"></a>        occupancy <span class="op">=</span> [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.history_occupancy]</span>
<span id="cb29-282"><a href="#cb29-282" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-283"><a href="#cb29-283" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Procesar clima para rellenar áreas (fill_between)</span></span>
<span id="cb29-284"><a href="#cb29-284" aria-hidden="true" tabindex="-1"></a>        w_times <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.history_weather]</span>
<span id="cb29-285"><a href="#cb29-285" aria-hidden="true" tabindex="-1"></a>        w_states <span class="op">=</span> [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.history_weather]</span>
<span id="cb29-286"><a href="#cb29-286" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-287"><a href="#cb29-287" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb29-288"><a href="#cb29-288" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-289"><a href="#cb29-289" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Dibujar Áreas de Tormenta</span></span>
<span id="cb29-290"><a href="#cb29-290" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(w_times)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb29-291"><a href="#cb29-291" aria-hidden="true" tabindex="-1"></a>            t_start <span class="op">=</span> w_times[i]</span>
<span id="cb29-292"><a href="#cb29-292" aria-hidden="true" tabindex="-1"></a>            t_end <span class="op">=</span> w_times[i<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb29-293"><a href="#cb29-293" aria-hidden="true" tabindex="-1"></a>            state <span class="op">=</span> w_states[i]</span>
<span id="cb29-294"><a href="#cb29-294" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-295"><a href="#cb29-295" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> state <span class="op">==</span> CLIMA_STORM:</span>
<span id="cb29-296"><a href="#cb29-296" aria-hidden="true" tabindex="-1"></a>                plt.axvspan(</span>
<span id="cb29-297"><a href="#cb29-297" aria-hidden="true" tabindex="-1"></a>                    t_start, t_end, </span>
<span id="cb29-298"><a href="#cb29-298" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, lw<span class="op">=</span><span class="dv">0</span></span>
<span id="cb29-299"><a href="#cb29-299" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb29-300"><a href="#cb29-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-301"><a href="#cb29-301" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Etiqueta fantasma para la leyenda del clima</span></span>
<span id="cb29-302"><a href="#cb29-302" aria-hidden="true" tabindex="-1"></a>        plt.axvspan(</span>
<span id="cb29-303"><a href="#cb29-303" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, </span>
<span id="cb29-304"><a href="#cb29-304" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Condición: Tormenta (Pista Cerrada)'</span></span>
<span id="cb29-305"><a href="#cb29-305" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-306"><a href="#cb29-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-307"><a href="#cb29-307" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Curva de Ocupación</span></span>
<span id="cb29-308"><a href="#cb29-308" aria-hidden="true" tabindex="-1"></a>        plt.step(</span>
<span id="cb29-309"><a href="#cb29-309" aria-hidden="true" tabindex="-1"></a>            times, occupancy, where<span class="op">=</span><span class="st">'post'</span>, </span>
<span id="cb29-310"><a href="#cb29-310" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'#003366'</span>, lw<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb29-311"><a href="#cb29-311" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Ocupación (Cola + Pista)'</span></span>
<span id="cb29-312"><a href="#cb29-312" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-313"><a href="#cb29-313" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-314"><a href="#cb29-314" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Marcar Abortos</span></span>
<span id="cb29-315"><a href="#cb29-315" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.history_aborts:</span>
<span id="cb29-316"><a href="#cb29-316" aria-hidden="true" tabindex="-1"></a>            ab_t <span class="op">=</span> [x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.history_aborts]</span>
<span id="cb29-317"><a href="#cb29-317" aria-hidden="true" tabindex="-1"></a>            ab_y <span class="op">=</span> [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>.history_aborts]</span>
<span id="cb29-318"><a href="#cb29-318" aria-hidden="true" tabindex="-1"></a>            plt.scatter(</span>
<span id="cb29-319"><a href="#cb29-319" aria-hidden="true" tabindex="-1"></a>                ab_t, ab_y, color<span class="op">=</span><span class="st">'red'</span>, </span>
<span id="cb29-320"><a href="#cb29-320" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="st">'x'</span>, s<span class="op">=</span><span class="dv">100</span>, zorder<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb29-321"><a href="#cb29-321" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Operación Abortada'</span></span>
<span id="cb29-322"><a href="#cb29-322" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb29-323"><a href="#cb29-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-324"><a href="#cb29-324" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Curva de Demanda Teórica (Referencia)</span></span>
<span id="cb29-325"><a href="#cb29-325" aria-hidden="true" tabindex="-1"></a>        t_ref <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="va">self</span>.t_max, <span class="dv">200</span>)</span>
<span id="cb29-326"><a href="#cb29-326" aria-hidden="true" tabindex="-1"></a>        lambda_ref <span class="op">=</span> [</span>
<span id="cb29-327"><a href="#cb29-327" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.get_arrival_rate(t) <span class="cf">for</span> t <span class="kw">in</span> t_ref</span>
<span id="cb29-328"><a href="#cb29-328" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb29-329"><a href="#cb29-329" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-330"><a href="#cb29-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normalización visual</span></span>
<span id="cb29-331"><a href="#cb29-331" aria-hidden="true" tabindex="-1"></a>        mx_ref <span class="op">=</span> <span class="bu">max</span>(lambda_ref) <span class="cf">if</span> lambda_ref <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb29-332"><a href="#cb29-332" aria-hidden="true" tabindex="-1"></a>        mx_occ <span class="op">=</span> <span class="bu">max</span>(occupancy) <span class="cf">if</span> occupancy <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb29-333"><a href="#cb29-333" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-334"><a href="#cb29-334" aria-hidden="true" tabindex="-1"></a>        scale_factor <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb29-335"><a href="#cb29-335" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mx_ref <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb29-336"><a href="#cb29-336" aria-hidden="true" tabindex="-1"></a>            scale_factor <span class="op">=</span> mx_occ <span class="op">/</span> mx_ref</span>
<span id="cb29-337"><a href="#cb29-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-338"><a href="#cb29-338" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Graficar perfil escalado</span></span>
<span id="cb29-339"><a href="#cb29-339" aria-hidden="true" tabindex="-1"></a>        plt.plot(</span>
<span id="cb29-340"><a href="#cb29-340" aria-hidden="true" tabindex="-1"></a>            t_ref, </span>
<span id="cb29-341"><a href="#cb29-341" aria-hidden="true" tabindex="-1"></a>            np.array(lambda_ref) <span class="op">*</span> <span class="fl">0.5</span>, </span>
<span id="cb29-342"><a href="#cb29-342" aria-hidden="true" tabindex="-1"></a>            <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb29-343"><a href="#cb29-343" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Perfil Demanda (NHPP) (Escalado)'</span></span>
<span id="cb29-344"><a href="#cb29-344" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-345"><a href="#cb29-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-346"><a href="#cb29-346" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Construcción del título</span></span>
<span id="cb29-347"><a href="#cb29-347" aria-hidden="true" tabindex="-1"></a>        title_str <span class="op">=</span> (</span>
<span id="cb29-348"><a href="#cb29-348" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Dinámica Aeroportuaria: Tráfico NHPP vs "</span></span>
<span id="cb29-349"><a href="#cb29-349" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Clima Gillespie</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb29-350"><a href="#cb29-350" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"(</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>stats[<span class="st">'aborted_ops'</span>]<span class="sc">}</span><span class="ss"> "</span></span>
<span id="cb29-351"><a href="#cb29-351" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"operaciones abortadas)"</span></span>
<span id="cb29-352"><a href="#cb29-352" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-353"><a href="#cb29-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-354"><a href="#cb29-354" aria-hidden="true" tabindex="-1"></a>        plt.title(title_str, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-355"><a href="#cb29-355" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Hora del día'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb29-356"><a href="#cb29-356" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(</span>
<span id="cb29-357"><a href="#cb29-357" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Cantidad de Aeronaves en Sistema'</span>, </span>
<span id="cb29-358"><a href="#cb29-358" aria-hidden="true" tabindex="-1"></a>            fontsize<span class="op">=</span><span class="dv">12</span></span>
<span id="cb29-359"><a href="#cb29-359" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-360"><a href="#cb29-360" aria-hidden="true" tabindex="-1"></a>        plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb29-361"><a href="#cb29-361" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb29-362"><a href="#cb29-362" aria-hidden="true" tabindex="-1"></a>        plt.xlim(<span class="dv">0</span>, <span class="va">self</span>.t_max)</span>
<span id="cb29-363"><a href="#cb29-363" aria-hidden="true" tabindex="-1"></a>        plt.ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-364"><a href="#cb29-364" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-365"><a href="#cb29-365" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb29-366"><a href="#cb29-366" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb29-367"><a href="#cb29-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-368"><a href="#cb29-368" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb29-369"><a href="#cb29-369" aria-hidden="true" tabindex="-1"></a><span class="co"># EJECUCIÓN</span></span>
<span id="cb29-370"><a href="#cb29-370" aria-hidden="true" tabindex="-1"></a><span class="co"># ==========================================</span></span>
<span id="cb29-371"><a href="#cb29-371" aria-hidden="true" tabindex="-1"></a>sim <span class="op">=</span> HybridAirportSim(t_max<span class="op">=</span>SIM_DURATION)</span>
<span id="cb29-372"><a href="#cb29-372" aria-hidden="true" tabindex="-1"></a>sim.run()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Iniciando Simulación Híbrida (24.0h) ---

==================================================
REPORTE DE SIMULACIÓN AEROPORTUARIA HÍBRIDA
==================================================
Duración Simulación     : 24.0 horas
Total Llegadas (NHPP)   : 304
Aterrizajes Exitosos    : 303
Operaciones Abortadas   : 1 (Go-arounds)
--------------------------------------------------
METEOROLOGÍA (GILLESPIE SSA)
Eventos de Cambio Clima : 6
Tiempo en Tormenta      : 2.84 h (11.8%)
==================================================
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="tpi-simulation-in-data-science_files/figure-html/cell-23-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="uso-de-inteligencia-artificial" class="level3">
<h3 class="anchored" data-anchor-id="uso-de-inteligencia-artificial">Uso de Inteligencia Artificial</h3>
<p>En este trabajo se utilizó inteligencia artificial (Gemini) para:</p>
<ul>
<li>Transformar código base de R a Python</li>
<li>Formatear gráficos</li>
<li>Formatear código para que no ocupe más de 70 caracteres (restricción de renderizado de Quarto)</li>
<li>Revisar estilo de la redacción</li>
</ul>
</section>
<section id="anexo-código-base-en-python" class="level3">
<h3 class="anchored" data-anchor-id="anexo-código-base-en-python">Anexo: Código base en Python</h3>
<div id="9f94b13a" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.03781,&quot;end_time&quot;:&quot;2025-12-09T04:13:42.996759&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:42.958949&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Código base</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear Congruential Generator (LGC)</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lcg(n, seed<span class="op">=</span><span class="dv">123</span>, a<span class="op">=</span><span class="dv">1103515245</span>, c<span class="op">=</span><span class="dv">12345</span>, m<span class="op">=</span><span class="dv">2</span><span class="op">**</span><span class="dv">31</span>):</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> seed</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    seq <span class="op">=</span> []</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> (a <span class="op">*</span> x <span class="op">+</span> c) <span class="op">%</span> m</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        seq.append(x<span class="op">/</span>m)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> seq</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>alea <span class="op">=</span> lcg(<span class="dv">10</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(alea)):</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(alea[i])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.20531828328967094
0.6873863865621388
0.7767890496179461
0.4024707484059036
0.5324797946959734
0.10148253152146935
0.6351402262225747
0.34936570515856147
0.7226534709334373
0.027218241710215807</code></pre>
</div>
</div>
<div id="365b27ef" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.043287,&quot;end_time&quot;:&quot;2025-12-09T04:13:43.069230&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:43.025943&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Código base</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimación de Pi por Monte Carlo</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, N)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, N)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>pi_est <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> np.mean(u1<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> u2<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Valor estimado de pi: </span><span class="sc">{</span>pi_est<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Valor estimado de pi: 3.14836</code></pre>
</div>
</div>
<div id="8011c99c" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:1.064166,&quot;end_time&quot;:&quot;2025-12-09T04:13:44.162851&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:43.098685&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Código base</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementación Metropolis–Hastings</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> binom</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mh(n_iter<span class="op">=</span><span class="dv">5000</span>, start<span class="op">=</span><span class="fl">0.5</span>, prop_sd<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inicializar la cadena (array lleno de ceros)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> np.zeros(n_iter)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    theta[<span class="dv">0</span>] <span class="op">=</span> start</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bucle desde el segundo elemento (índice 1) hasta el final</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n_iter):</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Propuesta: Distribución normal centrada en el theta anterior</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Equivalente en R: rnorm(1, theta[t-1], prop_sd)</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        prop <span class="op">=</span> np.random.normal(loc<span class="op">=</span>theta[t<span class="op">-</span><span class="dv">1</span>], scale<span class="op">=</span>prop_sd)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verificación de límites (Prior Uniforme Implícito [0,1])</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si la propuesta se sale del rango [0, 1], se rechaza inmediatamente</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prop <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> prop <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>            theta[t] <span class="op">=</span> theta[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calcular la Verosimilitud (Likelihood) usando la función </span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># de masa de probabilidad</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Equivalente en R: dbinom(7, 10, prob)</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># * 1 representa el Prior (Uniforme)</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>            num <span class="op">=</span> binom.pmf(k<span class="op">=</span><span class="dv">7</span>, n<span class="op">=</span><span class="dv">10</span>, p<span class="op">=</span>prop) <span class="op">*</span> <span class="dv">1</span>      </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>            den <span class="op">=</span> binom.pmf(k<span class="op">=</span><span class="dv">7</span>, n<span class="op">=</span><span class="dv">10</span>, p<span class="op">=</span>theta[t<span class="op">-</span><span class="dv">1</span>]) <span class="op">*</span> <span class="dv">1</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Probabilidad de aceptación (alpha)</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>            ratio <span class="op">=</span> num <span class="op">/</span> den</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>            alpha <span class="op">=</span> <span class="bu">min</span>(<span class="dv">1</span>, ratio)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Paso de Aceptación o Rechazo</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Generamos un número aleatorio uniforme </span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># y lo comparamos con alpha</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> np.random.uniform() <span class="op">&lt;</span> alpha:</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Aceptar la propuesta</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>                theta[t] <span class="op">=</span> prop     </span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Rechazar y mantener el valor anterior</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>                theta[t] <span class="op">=</span> theta[t<span class="op">-</span><span class="dv">1</span>] </span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> mh()</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Media Posterior Estimada: </span><span class="sc">{</span>np<span class="sc">.</span>mean(chain)<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Media Posterior Estimada: 0.6778</code></pre>
</div>
</div>
<div id="02e3b827" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.041972,&quot;end_time&quot;:&quot;2025-12-09T04:13:44.234222&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:44.192250&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Codigo base </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulación de Eventos Discretos (M/M/1 o M/M/c)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_mm1(lam, mu, T_max):</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nota: 'lambda' es una palabra reservada en Python, usamos 'lam'</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># R usa la tasa (rate) para rexp: rexp(1, lambda)</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Numpy usa la escala (scale = 1/rate): exponential(1/lam)</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    t_arr <span class="op">=</span> np.random.exponential(scale<span class="op">=</span><span class="dv">1</span><span class="op">/</span>lam)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    t_dep <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)  <span class="co"># Infinito en Python</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    arrivals <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    departures <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    wait_times <span class="op">=</span> []  </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> t <span class="op">&lt;</span> T_max:</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> t_arr <span class="op">&lt;</span> t_dep:</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># --- Evento de Llegada ---</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> t_arr</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>            n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>            arrivals <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Si el servidor estaba libre (n=1 tras la llegada)</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># se programa servicio</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>                t_dep <span class="op">=</span> t <span class="op">+</span> np.random.exponential(scale<span class="op">=</span><span class="dv">1</span><span class="op">/</span>mu)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Programar la siguiente llegada</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>            t_arr <span class="op">=</span> t <span class="op">+</span> np.random.exponential(scale<span class="op">=</span><span class="dv">1</span><span class="op">/</span>lam)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Evento de Salida</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>            t <span class="op">=</span> t_dep</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>            n <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>            departures <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Se agrega el tiempo a la lista</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>            wait_times.append(t_dep) </span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Si quedan clientes, programar la siguiente salida</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>                t_dep <span class="op">=</span> t <span class="op">+</span> np.random.exponential(scale<span class="op">=</span><span class="dv">1</span><span class="op">/</span>mu)</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Si no hay nadie, la próxima salida es "infinita"</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>                t_dep <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Se devuelve un diccionario con los tiempos</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"arrivals"</span>: arrivals, </span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"departures"</span>: departures, </span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wait_times"</span>: wait_times</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda = 2 clientes/min, Mu = 3 clientes/min, Tiempo = 100 min</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> simulate_mm1(lam<span class="op">=</span><span class="dv">2</span>, mu<span class="op">=</span><span class="dv">3</span>, T_max<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Llegadas totales: </span><span class="sc">{</span>res[<span class="st">'arrivals'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Salidas totales: </span><span class="sc">{</span>res[<span class="st">'departures'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Últimos 5 tiempos de salida:"</span>)</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(res[<span class="st">'wait_times'</span>])<span class="op">-</span><span class="dv">5</span>,<span class="bu">len</span>(res[<span class="st">'wait_times'</span>])):</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(res[<span class="st">'wait_times'</span>][i])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Llegadas totales: 215
Salidas totales: 215
Últimos 5 tiempos de salida:
98.43347389754513
98.50944958825472
99.40263056754019
99.71489988562641
100.03483812961011</code></pre>
</div>
</div>
<div id="8662c363" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;papermill&quot;,&quot;value&quot;:{&quot;duration&quot;:0.04721,&quot;end_time&quot;:&quot;2025-12-09T04:13:44.312302&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2025-12-09T04:13:44.265092&quot;,&quot;status&quot;:&quot;completed&quot;}}" data-tags="[]" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Codigo base</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementación Gillespie SSA</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gillespie(Tmax, k1<span class="op">=</span><span class="dv">10</span>, k2<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Listas para almacenar el historial</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    ts <span class="op">=</span> [t]</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> [X]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> t <span class="op">&lt;</span> Tmax:</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Cálculo de propensiones</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        a1 <span class="op">=</span> k1</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        a2 <span class="op">=</span> k2 <span class="op">*</span> X</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        a0 <span class="op">=</span> a1 <span class="op">+</span> a2</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si la propensión total es 0, el sistema se detiene</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a0 <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Generar tiempo hasta el próximo evento (tau)</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># R: -log(runif(1)) / a0 </span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Esto es matemáticamente generar una variable </span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># aleatoria Exponencial con tasa a0</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        tau <span class="op">=</span> np.random.exponential(scale<span class="op">=</span><span class="dv">1</span><span class="op">/</span>a0)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Determinar qué evento ocurre</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        r2 <span class="op">=</span> np.random.uniform()</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> r2 <span class="op">*</span> a0 <span class="op">&lt;</span> a1:</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Evento 1: Nacimiento / Producción</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>            X <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Evento 2: Muerte / Degradación</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>            X <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, X <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Actualizar tiempo y almacenar estado</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>        t <span class="op">+=</span> tau</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>        ts.append(t)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>        xs.append(X)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Devolvemos un DataFrame de Pandas </span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">'time'</span>: ts, <span class="st">'X'</span>: xs})</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>df_result <span class="op">=</span> gillespie(Tmax<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar las primeras 5 filas</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_result.head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       time  X
0  0.000000  0
1  0.031461  1
2  0.052792  2
3  0.214520  3
4  0.226669  4</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>